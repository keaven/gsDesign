<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Conditional and Predictive Power, Overall and Conditional Probability of Success — gsCP • gsDesign</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Conditional and Predictive Power, Overall and Conditional Probability of Success — gsCP" />
<meta property="og:description" content="gsCP() computes conditional boundary crossing probabilities at future
planned analyses for a given group sequential design assuming an interim
z-statistic at a specified interim analysis. While gsCP() is designed
toward computing conditional power for a variety of underlying parameter
values, condPower is built to compute conditional power for a
variety of interim test statistic values which is useful for sample size
adaptation (see ssrCP). gsPP() averages conditional
power across a posterior distribution to compute predictive power.
gsPI() computes Bayesian prediction intervals for future analyses
corresponding to results produced by gsPP().  gsPosterior()
computes the posterior density for the group sequential design parameter of
interest given a prior density and an interim outcome that is exact or in an
interval. gsPOS() computes the probability of success for a trial
using a prior distribution to average power over a set of theta
values of interest. gsCPOS() assumes no boundary has been crossed
before and including an interim analysis of interest, and computes the
probability of success based on this event. Note that gsCP() and
gsPP() take only the interim test statistic into account in computing
conditional probabilities, while gsCPOS() conditions on not crossing
any bound through a specified interim analysis.
See Conditional power section of manual for further clarification. See also
Muller and Schaffer (2001) for background theory.
For gsPP(), gsPI(), gsPOS() and gsCPOS(), the
prior distribution for the standardized parameter theta () for a
group sequential design specified through a gsDesign object is specified
through the arguments theta and wgts. This can be a discrete
or a continuous probability density function. For a discrete function,
generally all weights would be 1. For a continuous density, the wgts
would contain integration grid weights, such as those provided by
normalGrid.
For gsPosterior, a prior distribution in prior must be
composed of the vectors z density.  The vector z
contains points where the prior is evaluated and density the
corresponding density or, for a discrete distribution, the probabilities of
each point in z. Densities may be supplied as from
normalGrid() where grid weights for numerical integration are
supplied in gridwgts. If gridwgts are not supplied, they are
defaulted to 1 (equal weighting). To ensure a proper prior distribution, you
must have sum(gridwgts * density) equal to 1; this is NOT checked,
however." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsDesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Conditional and Predictive Power, Overall and Conditional Probability of Success</h1>
    
    <div class="hidden name"><code>gsCP.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>gsCP()</code> computes conditional boundary crossing probabilities at future
planned analyses for a given group sequential design assuming an interim
z-statistic at a specified interim analysis. While <code>gsCP()</code> is designed
toward computing conditional power for a variety of underlying parameter
values, <code><a href='ssrCP.html'>condPower</a></code> is built to compute conditional power for a
variety of interim test statistic values which is useful for sample size
adaptation (see <code><a href='ssrCP.html'>ssrCP</a></code>). <code>gsPP()</code> averages conditional
power across a posterior distribution to compute predictive power.
<code>gsPI()</code> computes Bayesian prediction intervals for future analyses
corresponding to results produced by <code>gsPP()</code>.  <code>gsPosterior()</code>
computes the posterior density for the group sequential design parameter of
interest given a prior density and an interim outcome that is exact or in an
interval. <code>gsPOS()</code> computes the probability of success for a trial
using a prior distribution to average power over a set of <code>theta</code>
values of interest. <code>gsCPOS()</code> assumes no boundary has been crossed
before and including an interim analysis of interest, and computes the
probability of success based on this event. Note that <code>gsCP()</code> and
<code>gsPP()</code> take only the interim test statistic into account in computing
conditional probabilities, while <code>gsCPOS()</code> conditions on not crossing
any bound through a specified interim analysis.</p>
<p>See Conditional power section of manual for further clarification. See also
Muller and Schaffer (2001) for background theory.</p>
<p>For <code>gsPP()</code>, <code>gsPI()</code>, <code>gsPOS()</code> and <code>gsCPOS()</code>, the
prior distribution for the standardized parameter <code>theta</code> () for a
group sequential design specified through a gsDesign object is specified
through the arguments <code>theta</code> and <code>wgts</code>. This can be a discrete
or a continuous probability density function. For a discrete function,
generally all weights would be 1. For a continuous density, the <code>wgts</code>
would contain integration grid weights, such as those provided by
<a href='normalGrid.html'>normalGrid</a>.</p>
<p>For <code>gsPosterior</code>, a prior distribution in <code>prior</code> must be
composed of the vectors <code>z</code> <code>density</code>.  The vector <code>z</code>
contains points where the prior is evaluated and <code>density</code> the
corresponding density or, for a discrete distribution, the probabilities of
each point in <code>z</code>. Densities may be supplied as from
<code><a href='normalGrid.html'>normalGrid()</a></code> where grid weights for numerical integration are
supplied in <code>gridwgts</code>. If <code>gridwgts</code> are not supplied, they are
defaulted to 1 (equal weighting). To ensure a proper prior distribution, you
must have <code><a href='https://rdrr.io/r/base/sum.html'>sum(gridwgts * density)</a></code> equal to 1; this is NOT checked,
however.</p>
    </div>

    <pre class="usage"><span class='fu'>gsCP</span>(<span class='no'>x</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>18</span>)

<span class='fu'>gsPP</span>(
  <span class='no'>x</span>,
  <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>zi</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>theta</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>3</span>),
  <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.5</span>),
  <span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>18</span>,
  <span class='kw'>total</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)

<span class='fu'>gsPI</span>(
  <span class='no'>x</span>,
  <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>zi</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>j</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='kw'>theta</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>3</span>),
  <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.5</span>)
)

<span class='fu'>gsPosterior</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(), <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='normalGrid.html'>normalGrid</a></span>(), <span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>18</span>)

<span class='fu'>gsPOS</span>(<span class='no'>x</span>, <span class='no'>theta</span>, <span class='no'>wgts</span>)

<span class='fu'>gsCPOS</span>(<span class='no'>i</span>, <span class='no'>x</span>, <span class='no'>theta</span>, <span class='no'>wgts</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object of type <code>gsDesign</code> or <code>gsProbability</code></p></td>
    </tr>
    <tr>
      <th>theta</th>
      <td><p>a vector with \(\theta\) value(s) at which conditional
power is to be computed; for <code>gsCP()</code> if <code>NULL</code>, an estimated
value of \(\theta\) based on the interim test statistic
(<code>zi/sqrt(x$n.I[i])</code>) as well as at <code>x$theta</code> is computed. For
<code>gsPosterior</code>, this may be a scalar or an interval; for <code>gsPP</code> and
<code>gsCP</code>, this must be a scalar.</p></td>
    </tr>
    <tr>
      <th>i</th>
      <td><p>analysis at which interim z-value is given; must be from 1 to
<code>x$k-1</code></p></td>
    </tr>
    <tr>
      <th>zi</th>
      <td><p>interim z-value at analysis i (scalar)</p></td>
    </tr>
    <tr>
      <th>r</th>
      <td><p>Integer value controlling grid for numerical integration as in
Jennison and Turnbull (2000); default is 18, range is 1 to 80.  Larger
values provide larger number of grid points and greater accuracy.  Normally
<code>r</code> will not be changed by the user.</p></td>
    </tr>
    <tr>
      <th>wgts</th>
      <td><p>Weights to be used with grid points in <code>theta</code>. Length can
be one if weights are equal, otherwise should be the same length as
<code>theta</code>. Values should be positive, but do not need to sum to 1.</p></td>
    </tr>
    <tr>
      <th>total</th>
      <td><p>The default of <code>total=TRUE</code> produces the combined
probability for all planned analyses after the interim analysis specified in
<code>i</code>. Otherwise, information on each analysis is provided separately.</p></td>
    </tr>
    <tr>
      <th>j</th>
      <td><p>specific analysis for which prediction is being made; must be
<code>&gt;i</code> and no more than <code>x$k</code></p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>The level to be used for Bayes credible intervals (which
approach confidence intervals for vague priors). The default
<code>level=.95</code> corresponds to a 95% credible interval. <code>level=0</code>
provides a point estimate rather than an interval.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>provides a prior distribution in the form produced by
<code><a href='normalGrid.html'>normalGrid</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>gsCP()</code> returns an object of the class <code>gsProbability</code>.
Based on the input design and the interim test statistic, the output
gsDesign object has bounds for test statistics computed based on solely on
observations after interim <code>i</code>.  Boundary crossing probabilities are
computed for the input \(\theta\) values. See manual and examples.</p>
<p><code>gsPP()</code> if total==TRUE, returns a real value indicating the predictive
power of the trial conditional on the interim test statistic <code>zi</code> at
analysis <code>i</code>; otherwise returns vector with predictive power for each
future planned analysis.</p>
<p><code>gsPI()</code> returns an interval (or point estimate if <code>level=0</code>)
indicating 100<code>level</code>% credible interval for the z-statistic at
analysis <code>j</code> conditional on the z-statistic at analysis <code>i&lt;j</code>.
The interval does not consider intervending interim analyses. The
probability estimate is based on the predictive distribution used for
<code>gsPP()</code> and requires a prior distribution for the group sequential
parameter <code>theta</code> specified in <code>theta</code> and <code>wgts</code>.</p>
<p><code>gsPosterior()</code> returns a posterior distribution containing the the
vector <code>z</code> input in <code>prior$z</code>, the posterior density in
<code>density</code>, grid weights for integrating the posterior density as input
in <code>prior$gridwgts</code> or defaulted to a vector of ones, and the product
of the output values in <code>density</code> and <code>gridwgts</code> in <code>wgts</code>.</p>
<p><code>gsPOS()</code> returns a real value indicating the probability of a positive
study weighted by the prior distribution input for <code>theta</code>.</p>
<p><code>gsCPOS()</code> returns a real value indicating the probability of a
positive study weighted by the posterior distribution derived from the
interim test statistic and the prior distribution input for <code>theta</code>
conditional on an interim test statistic.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The manual is not linked to this help file, but is available in
library/gsdesign/doc/gsDesignManual.pdf in the directory where R is
installed.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Jennison C and Turnbull BW (2000), <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Boca Raton: Chapman and Hall.</p>
<p>Proschan, Michael A., Lan, KK Gordon and Wittes, Janet Turk (2006),
<em>Statiscal Monitoring of Clinical Trials</em>. NY: Springer.</p>
<p>Muller, Hans-Helge and Schaffer, Helmut (2001), Adaptive group sequential
designs for clinical trials: combining the advantages of adaptive and
classical group sequential approaches. <em>Biometrics</em>;57:886-891.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='normalGrid.html'>normalGrid</a></code>, <code><a href='gsDesign.html'>gsDesign</a></code>,
<code><a href='gsProbability.html'>gsProbability</a></code>, <code><a href='gsBoundCP.html'>gsBoundCP</a></code>, <code><a href='ssrCP.html'>ssrCP</a></code>,
<code><a href='ssrCP.html'>condPower</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ggplot2</span>)
<span class='co'># set up a group sequential design</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>5</span>)
<span class='no'>x</span></div><div class='output co'>#&gt; Asymmetric two-sided group sequential design with
#&gt; 90 % power and 2.5 % Type I Error.
#&gt; Upper bound spending computations assume
#&gt; trial continues if lower bound is crossed.
#&gt; 
#&gt;            Sample
#&gt;             Size    ----Lower bounds----  ----Upper bounds-----
#&gt;   Analysis Ratio*   Z   Nominal p Spend+  Z   Nominal p Spend++
#&gt;          1  0.220 -0.90    0.1836 0.0077 3.25    0.0006  0.0006
#&gt;          2  0.441 -0.04    0.4853 0.0115 2.99    0.0014  0.0013
#&gt;          3  0.661  0.69    0.7563 0.0171 2.69    0.0036  0.0028
#&gt;          4  0.881  1.36    0.9131 0.0256 2.37    0.0088  0.0063
#&gt;          5  1.101  2.03    0.9786 0.0381 2.03    0.0214  0.0140
#&gt;      Total                        0.1000                 0.0250 
#&gt; + lower bound beta spending (under H1):
#&gt;  Hwang-Shih-DeCani spending function with gamma = -2.
#&gt; ++ alpha spending:
#&gt;  Hwang-Shih-DeCani spending function with gamma = -4.
#&gt; * Sample size ratio compared to fixed design with no interim
#&gt; 
#&gt; Boundary crossing probabilities and expected sample size
#&gt; assume any cross stops the trial
#&gt; 
#&gt; Upper boundary (power or Type I Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3      4      5  Total   E{N}
#&gt;   0.0000 0.0006 0.0013 0.0028 0.0062 0.0117 0.0226 0.5726
#&gt;   3.2415 0.0417 0.1679 0.2806 0.2654 0.1444 0.9000 0.7440
#&gt; 
#&gt; Lower boundary (futility or Type II Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3      4      5  Total
#&gt;   0.0000 0.1836 0.3201 0.2700 0.1477 0.0559 0.9774
#&gt;   3.2415 0.0077 0.0115 0.0171 0.0256 0.0381 0.1000</div><div class='input'>
<span class='co'># set up a prior distribution for the treatment effect</span>
<span class='co'># that is normal with mean .75*x$delta and standard deviation x$delta/2</span>
<span class='no'>mu0</span> <span class='kw'>&lt;-</span> <span class='fl'>.75</span> * <span class='no'>x</span>$<span class='no'>delta</span>
<span class='no'>sigma0</span> <span class='kw'>&lt;-</span> <span class='no'>x</span>$<span class='no'>delta</span> / <span class='fl'>2</span>
<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='normalGrid.html'>normalGrid</a></span>(<span class='kw'>mu</span> <span class='kw'>=</span> <span class='no'>mu0</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='no'>sigma0</span>)

<span class='co'># compute POS for the design given the above prior distribution for theta</span>
<span class='fu'>gsPOS</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>)</div><div class='output co'>#&gt; [1] 0.5954771</div><div class='input'>
<span class='co'># assume POS should only count cases in prior where theta &gt;= x$delta/2</span>
<span class='fu'>gsPOS</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span> * (<span class='no'>prior</span>$<span class='no'>z</span> <span class='kw'>&gt;=</span> <span class='no'>x</span>$<span class='no'>delta</span> / <span class='fl'>2</span>))</div><div class='output co'>#&gt; [1] 0.5554313</div><div class='input'>
<span class='co'># assuming a z-value at lower bound at analysis 2, what are conditional</span>
<span class='co'># boundary crossing probabilities for future analyses</span>
<span class='co'># assuming theta values from x as well as a value based on the interim</span>
<span class='co'># observed z</span>
<span class='no'>CP</span> <span class='kw'>&lt;-</span> <span class='fu'>gsCP</span>(<span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>lower</span>$<span class='no'>bound</span>[<span class='fl'>2</span>])
<span class='no'>CP</span></div><div class='output co'>#&gt;               Lower bounds   Upper bounds
#&gt;   Analysis N   Z   Nominal p  Z   Nominal p
#&gt;          1  1 1.25    0.8952 4.71    0.0000
#&gt;          2  1 1.96    0.9750 3.39    0.0003
#&gt;          3  1 2.64    0.9959 2.64    0.0041
#&gt; 
#&gt; Boundary crossing probabilities and expected sample size assume
#&gt; any cross stops the trial
#&gt; 
#&gt; Upper boundary (power or Type I Error)
#&gt;           Analysis
#&gt;     Theta     1      2      3  Total E{N}
#&gt;   -0.0554 0e+00 0.0003 0.0019 0.0022  0.2
#&gt;    0.0000 0e+00 0.0003 0.0022 0.0026  0.2
#&gt;    3.2415 7e-04 0.1038 0.2631 0.3677  0.4
#&gt; 
#&gt; Lower boundary (futility or Type II Error)
#&gt;           Analysis
#&gt;     Theta      1      2      3  Total
#&gt;   -0.0554 0.8999 0.0841 0.0138 0.9978
#&gt;    0.0000 0.8952 0.0872 0.0150 0.9974
#&gt;    3.2415 0.3950 0.1368 0.1006 0.6323</div><div class='input'>
<span class='co'># summing values for crossing future upper bounds gives overall</span>
<span class='co'># conditional power for each theta value</span>
<span class='no'>CP</span>$<span class='no'>theta</span></div><div class='output co'>#&gt; [1] -0.05536767  0.00000000  3.24151555</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>(<span class='no'>CP</span>$<span class='no'>upper</span>$<span class='no'>prob</span>) <span class='kw'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>)</div><div class='output co'>#&gt;             [,1]
#&gt; [1,] 0.002238566
#&gt; [2,] 0.002561570
#&gt; [3,] 0.367657693</div><div class='input'>
<span class='co'># compute predictive probability based on above assumptions</span>
<span class='fu'>gsPP</span>(<span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>lower</span>$<span class='no'>bound</span>[<span class='fl'>2</span>], <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>)</div><div class='output co'>#&gt; [1] 0.06730167</div><div class='input'>
<span class='co'># if it is known that boundary not crossed at interim 2, use</span>
<span class='co'># gsCPOS to compute conditional POS based on this</span>
<span class='fu'>gsCPOS</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>)</div><div class='output co'>#&gt; [1] 0.6114033</div><div class='input'>
<span class='co'># 2-stage example to compare results to direct computation</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='no'>z1</span> <span class='kw'>&lt;-</span> <span class='fl'>0.5</span>
<span class='no'>n1</span> <span class='kw'>&lt;-</span> <span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>1</span>]
<span class='no'>n2</span> <span class='kw'>&lt;-</span> <span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>2</span>] - <span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>1</span>]
<span class='no'>thetahat</span> <span class='kw'>&lt;-</span> <span class='no'>z1</span> / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>n1</span>)
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>thetahat</span>, <span class='fl'>0</span>, <span class='no'>x</span>$<span class='no'>delta</span>)

<span class='co'># conditional power direct computation - comparison w gsCP</span>
<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span>((<span class='no'>n2</span> * <span class='no'>theta</span> + <span class='no'>z1</span> * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>n1</span>) - <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>2</span>] * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>n1</span> + <span class='no'>n2</span>)) / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>n2</span>))</div><div class='output co'>#&gt; [1] 0.03579292 0.01067483 0.51555676</div><div class='input'>
<span class='fu'>gsCP</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>z1</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>)$<span class='no'>upper</span>$<span class='no'>prob</span></div><div class='output co'>#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] 0.03579292 0.01067483 0.5155568</div><div class='input'>
<span class='co'># predictive power direct computation - comparison w gsPP</span>
<span class='co'># use same prior as above</span>
<span class='no'>mu0</span> <span class='kw'>&lt;-</span> <span class='fl'>.75</span> * <span class='no'>x</span>$<span class='no'>delta</span> * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>2</span>])
<span class='no'>sigma2</span> <span class='kw'>&lt;-</span> (<span class='fl'>.5</span> * <span class='no'>x</span>$<span class='no'>delta</span>)^<span class='fl'>2</span> * <span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>2</span>]
<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='normalGrid.html'>normalGrid</a></span>(<span class='kw'>mu</span> <span class='kw'>=</span> <span class='fl'>.75</span> * <span class='no'>x</span>$<span class='no'>delta</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>delta</span> / <span class='fl'>2</span>)
<span class='fu'>gsPP</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>z1</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>)</div><div class='output co'>#&gt; [1] 0.1556447</div><div class='input'><span class='no'>t</span> <span class='kw'>&lt;-</span> <span class='fl'>.5</span>
<span class='no'>z1</span> <span class='kw'>&lt;-</span> <span class='fl'>.5</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='no'>z1</span> * <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>t</span>)
<span class='co'># direct from Proschan, Lan and Wittes eqn 3.10</span>
<span class='co'># adjusted drift at n.I[2]</span>
<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span>(((<span class='no'>b</span> - <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>2</span>]) * (<span class='fl'>1</span> + <span class='no'>t</span> * <span class='no'>sigma2</span>) +
  (<span class='fl'>1</span> - <span class='no'>t</span>) * (<span class='no'>mu0</span> + <span class='no'>b</span> * <span class='no'>sigma2</span>)) /
  <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>((<span class='fl'>1</span> - <span class='no'>t</span>) * (<span class='fl'>1</span> + <span class='no'>sigma2</span>) * (<span class='fl'>1</span> + <span class='no'>t</span> * <span class='no'>sigma2</span>)))</div><div class='output co'>#&gt; [1] 0.1556447</div><div class='input'>
<span class='co'># plot prior then posterior distribution for unblinded analysis with i=1, zi=1</span>
<span class='no'>xp</span> <span class='kw'>&lt;-</span> <span class='fu'>gsPosterior</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>prior</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>xp</span>$<span class='no'>z</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>xp</span>$<span class='no'>density</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"l"</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>theta</span>), <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"Density"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>z</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>density</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='fl'>1</span>)</div><div class='input'>
<span class='co'># add posterior plot assuming only knowlede that interim bound has</span>
<span class='co'># not been crossed at interim 1</span>
<span class='no'>xpb</span> <span class='kw'>&lt;-</span> <span class='fu'>gsPosterior</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>prior</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>xpb</span>$<span class='no'>z</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>xpb</span>$<span class='no'>density</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='fl'>4</span>)</div><div class='img'><img src='gsCP-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># prediction interval based in interim 1 results</span>
<span class='co'># start with point estimate, followed by 90% prediction interval</span>
<span class='fu'>gsPI</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>z1</span>, <span class='kw'>j</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>0</span>)</div><div class='output co'>#&gt; [1] 1.081745</div><div class='input'><span class='fu'>gsPI</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>zi</span> <span class='kw'>=</span> <span class='no'>z1</span>, <span class='kw'>j</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>z</span>, <span class='kw'>wgts</span> <span class='kw'>=</span> <span class='no'>prior</span>$<span class='no'>wgts</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>.9</span>)</div><div class='output co'>#&gt; [1] -0.3793133  2.5428090</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


