<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Sample size re-estimation based on conditional power — condPower • gsDesign</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet"><script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Sample size re-estimation based on conditional power — condPower"><meta name="description" content="ssrCP() adapts 2-stage group sequential designs to 2-stage sample
size re-estimation designs based on interim analysis conditional power. This
is a simple case of designs developed by Lehmacher and Wassmer, Biometrics
(1999). The conditional power designs of Bauer and Kohne (1994),
Proschan and Hunsberger (1995), Cui, Hung and Wang (1999) and Liu and Chi (2001),
Gao, Ware and Mehta (2008), and Mehta and Pocock (2011). Either the estimated
treatment effect at the interim analysis or any chosen effect size can be
used for sample size re-estimation. If not done carefully, these designs can
be very inefficient. It is probably a good idea to compare any design to a
simpler group sequential design; see, for example, Jennison and Turnbull
(2003). The a assumes a small Type I error is included with the interim
analysis and that the design is an adaptation from a 2-stage group
sequential design Related functions include 3 pre-defined combination test
functions (z2NC, z2Z, z2Fisher) that represent the
inverse normal combination test (Lehmacher and Wassmer, 1999), the
sufficient statistic for the complete data, and Fisher's combination test.
Power.ssrCP computes unconditional power for a conditional power
design derived by ssrCP.
condPower is a supportive routine that also is interesting in its own
right; it computes conditional power of a combination test given an interim
test statistic, stage 2 sample size and combination test statistic. While
the returned data frame should make general plotting easy, the function
plot.ssrCP() prints a plot of study sample size by stage 1 outcome
with multiple x-axis labels for stage 1 z-value, conditional power, and
stage 1 effect size relative to the effect size for which the underlying
group sequential design was powered.
Sample size re-estimation using conditional power and an interim estimate of
treatment effect was proposed by several authors in the 1990's (see
references below). Statistical testing for these original methods was based
on combination tests since Type I error could be inflated by using a
sufficient statistic for testing at the end of the trial. Since 2000, more
efficient variations of these conditional power designs have been developed.
Fully optimized designs have also been derived (Posch et all, 2003,
Lokhnygina and Tsiatis, 2008). Some of the later conditional power methods
allow use of sufficient statistics for testing (Chen, DeMets and Lan, 2004,
Gao, Ware and Mehta, 2008, and Mehta and Pocock, 2011).
The methods considered here are extensions of 2-stage group sequential
designs that include both an efficacy and a futility bound at the planned
interim analysis. A maximum fold-increase in sample size (maxinc)from
the supplied group sequential design (x) is specified by the user, as
well as a range of conditional power (cpadj) where sample size should
be re-estimated at the interim analysis, 1-the targeted conditional power to
be used for sample size re-estimation (beta) and a combination test
statistic (z2) to be used for testing at the end of the trial. The
input value overrun represents incremental enrollment not included in
the interim analysis that is not included in the analysis; this is used for
calculating the required number of patients enrolled to complete the trial.
Whereas most of the methods proposed have been based on using the interim
estimated treatment effect size (default for ssrCP), the variable
theta allows the user to specify an alternative; Liu and Chi (2001)
suggest that using the parameter value for which the trial was originally
powered is a good choice."><meta property="og:description" content="ssrCP() adapts 2-stage group sequential designs to 2-stage sample
size re-estimation designs based on interim analysis conditional power. This
is a simple case of designs developed by Lehmacher and Wassmer, Biometrics
(1999). The conditional power designs of Bauer and Kohne (1994),
Proschan and Hunsberger (1995), Cui, Hung and Wang (1999) and Liu and Chi (2001),
Gao, Ware and Mehta (2008), and Mehta and Pocock (2011). Either the estimated
treatment effect at the interim analysis or any chosen effect size can be
used for sample size re-estimation. If not done carefully, these designs can
be very inefficient. It is probably a good idea to compare any design to a
simpler group sequential design; see, for example, Jennison and Turnbull
(2003). The a assumes a small Type I error is included with the interim
analysis and that the design is an adaptation from a 2-stage group
sequential design Related functions include 3 pre-defined combination test
functions (z2NC, z2Z, z2Fisher) that represent the
inverse normal combination test (Lehmacher and Wassmer, 1999), the
sufficient statistic for the complete data, and Fisher's combination test.
Power.ssrCP computes unconditional power for a conditional power
design derived by ssrCP.
condPower is a supportive routine that also is interesting in its own
right; it computes conditional power of a combination test given an interim
test statistic, stage 2 sample size and combination test statistic. While
the returned data frame should make general plotting easy, the function
plot.ssrCP() prints a plot of study sample size by stage 1 outcome
with multiple x-axis labels for stage 1 z-value, conditional power, and
stage 1 effect size relative to the effect size for which the underlying
group sequential design was powered.
Sample size re-estimation using conditional power and an interim estimate of
treatment effect was proposed by several authors in the 1990's (see
references below). Statistical testing for these original methods was based
on combination tests since Type I error could be inflated by using a
sufficient statistic for testing at the end of the trial. Since 2000, more
efficient variations of these conditional power designs have been developed.
Fully optimized designs have also been derived (Posch et all, 2003,
Lokhnygina and Tsiatis, 2008). Some of the later conditional power methods
allow use of sufficient statistics for testing (Chen, DeMets and Lan, 2004,
Gao, Ware and Mehta, 2008, and Mehta and Pocock, 2011).
The methods considered here are extensions of 2-stage group sequential
designs that include both an efficacy and a futility bound at the planned
interim analysis. A maximum fold-increase in sample size (maxinc)from
the supplied group sequential design (x) is specified by the user, as
well as a range of conditional power (cpadj) where sample size should
be re-estimated at the interim analysis, 1-the targeted conditional power to
be used for sample size re-estimation (beta) and a combination test
statistic (z2) to be used for testing at the end of the trial. The
input value overrun represents incremental enrollment not included in
the interim analysis that is not included in the analysis; this is used for
calculating the required number of patients enrolled to complete the trial.
Whereas most of the methods proposed have been based on using the interim
estimated treatment effect size (default for ssrCP), the variable
theta allows the user to specify an alternative; Liu and Chi (2001)
suggest that using the parameter value for which the trial was originally
powered is a good choice."><meta property="og:image" content="https://keaven.github.io/gsDesign/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Sample size re-estimation based on conditional power</h1>
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesign/blob/v3.6.4/R/ssrCP.R" class="external-link"><code>R/ssrCP.R</code></a></small>
      <div class="d-none name"><code>ssrCP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ssrCP()</code> adapts 2-stage group sequential designs to 2-stage sample
size re-estimation designs based on interim analysis conditional power. This
is a simple case of designs developed by Lehmacher and Wassmer, Biometrics
(1999). The conditional power designs of Bauer and Kohne (1994),
Proschan and Hunsberger (1995), Cui, Hung and Wang (1999) and Liu and Chi (2001),
Gao, Ware and Mehta (2008), and Mehta and Pocock (2011). Either the estimated
treatment effect at the interim analysis or any chosen effect size can be
used for sample size re-estimation. If not done carefully, these designs can
be very inefficient. It is probably a good idea to compare any design to a
simpler group sequential design; see, for example, Jennison and Turnbull
(2003). The a assumes a small Type I error is included with the interim
analysis and that the design is an adaptation from a 2-stage group
sequential design Related functions include 3 pre-defined combination test
functions (<code>z2NC</code>, <code>z2Z</code>, <code>z2Fisher</code>) that represent the
inverse normal combination test (Lehmacher and Wassmer, 1999), the
sufficient statistic for the complete data, and Fisher's combination test.
<code>Power.ssrCP</code> computes unconditional power for a conditional power
design derived by <code>ssrCP</code>.</p>
<p><code>condPower</code> is a supportive routine that also is interesting in its own
right; it computes conditional power of a combination test given an interim
test statistic, stage 2 sample size and combination test statistic. While
the returned data frame should make general plotting easy, the function
<code>plot.ssrCP()</code> prints a plot of study sample size by stage 1 outcome
with multiple x-axis labels for stage 1 z-value, conditional power, and
stage 1 effect size relative to the effect size for which the underlying
group sequential design was powered.</p>
<p>Sample size re-estimation using conditional power and an interim estimate of
treatment effect was proposed by several authors in the 1990's (see
references below). Statistical testing for these original methods was based
on combination tests since Type I error could be inflated by using a
sufficient statistic for testing at the end of the trial. Since 2000, more
efficient variations of these conditional power designs have been developed.
Fully optimized designs have also been derived (Posch et all, 2003,
Lokhnygina and Tsiatis, 2008). Some of the later conditional power methods
allow use of sufficient statistics for testing (Chen, DeMets and Lan, 2004,
Gao, Ware and Mehta, 2008, and Mehta and Pocock, 2011).</p>
<p>The methods considered here are extensions of 2-stage group sequential
designs that include both an efficacy and a futility bound at the planned
interim analysis. A maximum fold-increase in sample size (<code>maxinc</code>)from
the supplied group sequential design (<code>x</code>) is specified by the user, as
well as a range of conditional power (<code>cpadj</code>) where sample size should
be re-estimated at the interim analysis, 1-the targeted conditional power to
be used for sample size re-estimation (<code>beta</code>) and a combination test
statistic (<code>z2</code>) to be used for testing at the end of the trial. The
input value <code>overrun</code> represents incremental enrollment not included in
the interim analysis that is not included in the analysis; this is used for
calculating the required number of patients enrolled to complete the trial.</p>
<p>Whereas most of the methods proposed have been based on using the interim
estimated treatment effect size (default for <code>ssrCP</code>), the variable
<code>theta</code> allows the user to specify an alternative; Liu and Chi (2001)
suggest that using the parameter value for which the trial was originally
powered is a good choice.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">condPower</span><span class="op">(</span></span>
<span>  <span class="va">z1</span>,</span>
<span>  <span class="va">n2</span>,</span>
<span>  z2 <span class="op">=</span> <span class="va">z2NC</span>,</span>
<span>  theta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, timing <span class="op">=</span> <span class="fl">0.5</span>, beta <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ssrCP</span><span class="op">(</span></span>
<span>  <span class="va">z1</span>,</span>
<span>  theta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maxinc <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  overrun <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">beta</span>,</span>
<span>  cpadj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, timing <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  z2 <span class="op">=</span> <span class="va">z2NC</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'ssrCP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  z1ticks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Adapted sample size"</span>,</span>
<span>  xlaboffset <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  col <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">z2NC</span><span class="op">(</span><span class="va">z1</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">z2Z</span><span class="op">(</span><span class="va">z1</span>, <span class="va">x</span>, n2 <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">z2Fisher</span><span class="op">(</span><span class="va">z1</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Power.ssrCP</span><span class="op">(</span><span class="va">x</span>, theta <span class="op">=</span> <span class="cn">NULL</span>, delta <span class="op">=</span> <span class="cn">NULL</span>, r <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-z-">z1<a class="anchor" aria-label="anchor" href="#arg-z-"></a></dt>
<dd><p>Scalar or vector with interim standardized Z-value(s). Input of
multiple values makes it easy to plot the revised sample size as a function
of the interim test statistic.</p></dd>


<dt id="arg-n-">n2<a class="anchor" aria-label="anchor" href="#arg-n-"></a></dt>
<dd><p>stage 2 sample size to be used in computing sufficient statistic
when combining stage 1 and 2 test statistics.</p></dd>


<dt id="arg-z-">z2<a class="anchor" aria-label="anchor" href="#arg-z-"></a></dt>
<dd><p>a combination function that returns a test statistic cutoff for
the stage 2 test based in the interim test statistic supplied in <code>z1</code>,
the design <code>x</code> and the stage 2 sample size.</p></dd>


<dt id="arg-theta">theta<a class="anchor" aria-label="anchor" href="#arg-theta"></a></dt>
<dd><p>If <code>NULL</code> (default), conditional power calculation will be
based on estimated interim treatment effect. Otherwise, <code>theta</code> is the
standardized effect size used for conditional power calculation. Using the
alternate hypothesis treatment effect can be more efficient than the
estimated effect size; see Liu and Chi, Biometrics (2001).</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A group sequential design with 2 stages (<code>k=2</code>) generated by
<code><a href="gsDesign.html">gsDesign</a></code>. For <code>plot.ssrCP</code>, <code>x</code> is a design returned
by <code>ssrCP()</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Allows passing of arguments that may be needed by the
user-supplied function, codez2. In the case of <code>plot.ssrCP()</code>, allows
passing more graphical parameters.</p></dd>


<dt id="arg-maxinc">maxinc<a class="anchor" aria-label="anchor" href="#arg-maxinc"></a></dt>
<dd><p>Maximum fold-increase from planned maximum sample size in
underlying group sequential design provided in <code>x</code>.</p></dd>


<dt id="arg-overrun">overrun<a class="anchor" aria-label="anchor" href="#arg-overrun"></a></dt>
<dd><p>The number of patients enrolled before the interim analysis
is completed who are not included in the interim analysis.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>Targeted Type II error (1 - targeted conditional power); used
for conditional power in sample size reestimation.</p></dd>


<dt id="arg-cpadj">cpadj<a class="anchor" aria-label="anchor" href="#arg-cpadj"></a></dt>
<dd><p>Range of values strictly between 0 and 1 specifying the range
of interim conditional power for which sample size re-estimation is to be
performed. Outside of this range, the sample size supplied in <code>x</code> is
used.</p></dd>


<dt id="arg-z-ticks">z1ticks<a class="anchor" aria-label="anchor" href="#arg-z-ticks"></a></dt>
<dd><p>Test statistic values at which tick marks are to be made on
x-axis; automatically calculated under default of <code>NULL</code></p></dd>


<dt id="arg-mar">mar<a class="anchor" aria-label="anchor" href="#arg-mar"></a></dt>
<dd><p>Plot margins; see help for <code>par</code></p></dd>


<dt id="arg-ylab">ylab<a class="anchor" aria-label="anchor" href="#arg-ylab"></a></dt>
<dd><p>y-axis label</p></dd>


<dt id="arg-xlaboffset">xlaboffset<a class="anchor" aria-label="anchor" href="#arg-xlaboffset"></a></dt>
<dd><p>offset on x-axis for printing x-axis labels</p></dd>


<dt id="arg-lty">lty<a class="anchor" aria-label="anchor" href="#arg-lty"></a></dt>
<dd><p>line type for stage 2 sample size</p></dd>


<dt id="arg-col">col<a class="anchor" aria-label="anchor" href="#arg-col"></a></dt>
<dd><p>line color for stage 2 sample size</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>Natural parameter values for power calculation; see
<code><a href="gsDesign.html">gsDesign</a></code> for a description of how this is related to
<code>theta</code>.</p></dd>


<dt id="arg-r">r<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>Integer value controlling grid for numerical integration as in
Jennison and Turnbull (2000); default is 18, range is 1 to 80.  Larger
values provide larger number of grid points and greater accuracy.  Normally
<code>r</code> will not be changed by the user.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>ssrCP</code> returns a list with the following items:</p>
<dl><dt>x</dt>
<dd><p>As
input.</p></dd>
 <dt>z2fn</dt>
<dd><p>As input in <code>z2</code>.</p></dd>
 <dt>theta</dt>
<dd><p>standardize effect
size used for conditional power; if <code>NULL</code> is input, this is computed
as <code>z1/sqrt(n1)</code> where <code>n1</code> is the stage 1 sample size.</p></dd>

<dt>maxinc</dt>
<dd><p>As input.</p></dd>
 <dt>overrun</dt>
<dd><p>As input.</p></dd>
 <dt>beta</dt>
<dd><p>As input.</p></dd>

<dt>cpadj</dt>
<dd><p>As input.</p></dd>
 <dt>dat</dt>
<dd><p>A data frame containing the input
<code>z1</code> values, computed cutoffs for the standard normal test statistic
based solely on stage 2 data (<code>z2</code>), stage 2 sample sizes (<code>n2</code>),
stage 2 conditional power (<code>CP</code>), standardize effect size used for
conditional power calculation (<code>theta</code>), and the natural parameter
value corresponding to <code>theta</code> (<code>delta</code>). The relation between
<code>theta</code> and <code>delta</code> is determined by the <code>delta0</code> and
<code>delta1</code> values from <code>x</code>: <code>delta = delta0 +
theta(delta1-delta0)</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bauer, Peter and Kohne, F., Evaluation of experiments with
adaptive interim analyses, Biometrics, 50:1029-1041, 1994.</p>
<p>Chen, YHJ, DeMets, DL and Lan, KKG. Increasing the sample size when the
unblinded interim result is promising, Statistics in Medicine, 23:1023-1038,
2004.</p>
<p>Gao, P, Ware, JH and Mehta, C, Sample size re-estimation for adaptive
sequential design in clinical trials, Journal of Biopharmaceutical
Statistics", 18:1184-1196, 2008.</p>
<p>Jennison, C and Turnbull, BW.  Mid-course sample size modification in
clinical trials based on the observed treatment effect. Statistics in
Medicine, 22:971-993", 2003.</p>
<p>Lehmacher, W and Wassmer, G. Adaptive sample size calculations in group
sequential trials, Biometrics, 55:1286-1290, 1999.</p>
<p>Liu, Q and Chi, GY., On sample size and inference for two-stage adaptive
designs, Biometrics, 57:172-177, 2001.</p>
<p>Mehta, C and Pocock, S. Adaptive increase in sample size when interim
results are promising: A practical guide with examples, Statistics in
Medicine, 30:3267-3284, 2011.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="gsDesign.html">gsDesign</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Keaven Anderson <a href="mailto:keaven_anderson@merck.com">keaven_anderson@merck.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># quick trick for simple conditional power based on interim z-value, stage 1 and 2 sample size</span></span></span>
<span class="r-in"><span><span class="co"># assumed treatment effect and final alpha level</span></span></span>
<span class="r-in"><span><span class="co"># and observed treatment effect</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">.01</span> <span class="co"># set final nominal significance level</span></span></span>
<span class="r-in"><span><span class="va">timing</span> <span class="op">&lt;-</span> <span class="fl">.6</span> <span class="co"># set proportion of sample size, events or statistical information at IA</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">40</span> <span class="co"># set stage 2 sample size events or statistical information</span></span></span>
<span class="r-in"><span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">.6</span> <span class="co"># for this example we will derive conditional power based on hazard ratios</span></span></span>
<span class="r-in"><span><span class="va">n.fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="nSurvival.html">nEvents</a></span><span class="op">(</span>hr<span class="op">=</span><span class="va">hr</span>,alpha<span class="op">=</span><span class="va">alpha</span><span class="op">)</span> <span class="co"># you could otherwise make n.fix an arbitrary positive value</span></span></span>
<span class="r-in"><span><span class="co"># this just derives a group sequential design that should not change sample size from n.fix</span></span></span>
<span class="r-in"><span><span class="co"># due to stringent IA bound</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">2</span>,n.fix<span class="op">=</span><span class="va">n.fix</span>,alpha<span class="op">=</span><span class="va">alpha</span>,test.type<span class="op">=</span><span class="fl">1</span>,sfu<span class="op">=</span><span class="va">sfHSD</span>,</span></span>
<span class="r-in"><span>sfupar<span class="op">=</span><span class="op">-</span><span class="fl">20</span>,timing<span class="op">=</span><span class="va">timing</span>,delta1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># derive effect sizes for which you wish to compute conditional power</span></span></span>
<span class="r-in"><span><span class="va">hrpostIA</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.4</span>,<span class="fl">1</span>,<span class="fl">.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># in the following, we convert HR into standardized effect size based on the design in x</span></span></span>
<span class="r-in"><span><span class="va">powr</span> <span class="op">&lt;-</span> <span class="fu">condPower</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,z1<span class="op">=</span><span class="fl">1</span>,n2<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hrpostIA</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">$</span><span class="va">delta1</span><span class="op">*</span><span class="va">x</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">hrpostIA</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="fu">condPower</span><span class="op">(</span></span></span>
<span class="r-in"><span>      x <span class="op">=</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>      z1 <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>      n2 <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>      theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hrpostIA</span><span class="op">)</span> <span class="op">/</span> <span class="va">x</span><span class="op">$</span><span class="va">delta1</span> <span class="op">*</span> <span class="va">x</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="st">"HR post IA"</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="st">"Conditional power"</span>,</span></span>
<span class="r-in"><span>    title <span class="op">=</span> <span class="st">"Conditional power as a function of assumed HR"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Following is a template for entering parameters for ssrCP</span></span></span>
<span class="r-in"><span><span class="co"># Natural parameter value null and alternate hypothesis values</span></span></span>
<span class="r-in"><span><span class="va">delta0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="va">delta1</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="co"># timing of interim analysis for underlying group sequential design</span></span></span>
<span class="r-in"><span><span class="va">timing</span> <span class="op">&lt;-</span> <span class="fl">.5</span></span></span>
<span class="r-in"><span><span class="co"># upper spending function</span></span></span>
<span class="r-in"><span><span class="va">sfu</span> <span class="op">&lt;-</span> <span class="va">sfHSD</span></span></span>
<span class="r-in"><span><span class="co"># upper spending function paramater</span></span></span>
<span class="r-in"><span><span class="va">sfupar</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">12</span></span></span>
<span class="r-in"><span><span class="co"># maximum sample size inflation</span></span></span>
<span class="r-in"><span><span class="va">maxinflation</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="co"># assumed enrollment overrrun at IA</span></span></span>
<span class="r-in"><span><span class="va">overrun</span> <span class="op">&lt;-</span> <span class="fl">25</span></span></span>
<span class="r-in"><span><span class="co"># interim z-values for plotting</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">.025</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Type I error (1-sided)</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">.025</span></span></span>
<span class="r-in"><span><span class="co"># Type II error for design</span></span></span>
<span class="r-in"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">.1</span></span></span>
<span class="r-in"><span><span class="co"># Fixed design sample size</span></span></span>
<span class="r-in"><span><span class="va">n.fix</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="co"># conditional power interval where sample</span></span></span>
<span class="r-in"><span><span class="co"># size is to be adjusted</span></span></span>
<span class="r-in"><span><span class="va">cpadj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># targeted Type II error when adapting sample size</span></span></span>
<span class="r-in"><span><span class="va">betastar</span> <span class="op">&lt;-</span> <span class="va">beta</span></span></span>
<span class="r-in"><span><span class="co"># combination test (built-in options are: z2Z, z2NC, z2Fisher)</span></span></span>
<span class="r-in"><span><span class="va">z2</span> <span class="op">&lt;-</span> <span class="va">z2NC</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use the above parameters to generate design</span></span></span>
<span class="r-in"><span><span class="co"># generate a 2-stage group sequential design with</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  k <span class="op">=</span> <span class="fl">2</span>, n.fix <span class="op">=</span> <span class="va">n.fix</span>, timing <span class="op">=</span> <span class="va">timing</span>, sfu <span class="op">=</span> <span class="va">sfu</span>, sfupar <span class="op">=</span> <span class="va">sfupar</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, delta0 <span class="op">=</span> <span class="va">delta0</span>, delta1 <span class="op">=</span> <span class="va">delta1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># extend this to a conditional power design</span></span></span>
<span class="r-in"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu">ssrCP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">x</span>, z1 <span class="op">=</span> <span class="va">z</span>, overrun <span class="op">=</span> <span class="va">overrun</span>, beta <span class="op">=</span> <span class="va">betastar</span>, cpadj <span class="op">=</span> <span class="va">cpadj</span>,</span></span>
<span class="r-in"><span>  maxinc <span class="op">=</span> <span class="va">maxinflation</span>, z2 <span class="op">=</span> <span class="va">z2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot the stage 2 sample size</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># demonstrate overlays on this plot</span></span></span>
<span class="r-in"><span><span class="co"># overlay with densities for z1 under different hypotheses</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">80</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">80</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">80</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">80</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">$</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">.75</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, at <span class="op">=</span> <span class="fl">80</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.4</span>, <span class="fl">.1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.4</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density for "</span>, <span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.5</span>, y <span class="op">=</span> <span class="fl">90</span>, col <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density for "</span>, <span class="va">theta</span>, <span class="st">"=0"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.00</span>, y <span class="op">=</span> <span class="fl">180</span>, col <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density for "</span>, <span class="va">theta</span>, <span class="st">"="</span>,</span></span>
<span class="r-in"><span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.00</span>, y <span class="op">=</span> <span class="fl">180</span>, col <span class="op">=</span> <span class="fl">4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density for "</span>, <span class="va">theta</span>, <span class="st">"="</span>,</span></span>
<span class="r-in"><span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"/2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.5</span>, y <span class="op">=</span> <span class="fl">140</span>, col <span class="op">=</span> <span class="fl">5</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density for "</span>, <span class="va">theta</span>, <span class="st">"="</span>,</span></span>
<span class="r-in"><span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"*.75"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># overall line for max sample size</span></span></span>
<span class="r-in"><span><span class="va">nalt</span> <span class="op">&lt;-</span> <span class="va">xx</span><span class="op">$</span><span class="va">maxinc</span> <span class="op">*</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"usr"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nalt</span>, <span class="va">nalt</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare above design with different combination tests</span></span></span>
<span class="r-in"><span><span class="co"># use sufficient statistic for final testing</span></span></span>
<span class="r-in"><span><span class="va">xxZ</span> <span class="op">&lt;-</span> <span class="fu">ssrCP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">x</span>, z1 <span class="op">=</span> <span class="va">z</span>, overrun <span class="op">=</span> <span class="va">overrun</span>, beta <span class="op">=</span> <span class="va">betastar</span>, cpadj <span class="op">=</span> <span class="va">cpadj</span>,</span></span>
<span class="r-in"><span>  maxinc <span class="op">=</span> <span class="va">maxinflation</span>, z2 <span class="op">=</span> <span class="va">z2Z</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use Fisher combination test for final testing</span></span></span>
<span class="r-in"><span><span class="va">xxFisher</span> <span class="op">&lt;-</span> <span class="fu">ssrCP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">x</span>, z1 <span class="op">=</span> <span class="va">z</span>, overrun <span class="op">=</span> <span class="va">overrun</span>, beta <span class="op">=</span> <span class="va">betastar</span>, cpadj <span class="op">=</span> <span class="va">cpadj</span>,</span></span>
<span class="r-in"><span>  maxinc <span class="op">=</span> <span class="va">maxinflation</span>, z2 <span class="op">=</span> <span class="va">z2Fisher</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># combine data frames from these designs</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xx</span><span class="op">$</span><span class="va">dat</span>, Test <span class="op">=</span> <span class="st">"Normal combination"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xxZ</span><span class="op">$</span><span class="va">dat</span>, Test <span class="op">=</span> <span class="st">"Sufficient statistic"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xxFisher</span><span class="op">$</span><span class="va">dat</span>, Test <span class="op">=</span> <span class="st">"Fisher combination"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot stage 2 statistic required for positive combination test</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z1</span>, y <span class="op">=</span> <span class="va">z2</span>, col <span class="op">=</span> <span class="va">Test</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># plot total sample size versus stage 1 test statistic</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z1</span>, y <span class="op">=</span> <span class="va">n2</span>, col <span class="op">=</span> <span class="va">Test</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># check achieved Type I error for sufficient statistic design</span></span></span>
<span class="r-in"><span><span class="fu">Power.ssrCP</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xxZ</span>, theta <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   theta delta     Power       en</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     0     0 0.0220804 95.11565</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare designs using observed vs planned theta for conditional power</span></span></span>
<span class="r-in"><span><span class="va">xxtheta1</span> <span class="op">&lt;-</span> <span class="fu">ssrCP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">x</span>, z1 <span class="op">=</span> <span class="va">z</span>, overrun <span class="op">=</span> <span class="va">overrun</span>, beta <span class="op">=</span> <span class="va">betastar</span>, cpadj <span class="op">=</span> <span class="va">cpadj</span>,</span></span>
<span class="r-in"><span>  maxinc <span class="op">=</span> <span class="va">maxinflation</span>, z2 <span class="op">=</span> <span class="va">z2</span>, theta <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">delta</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># combine data frames for the 2 designs</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xx</span><span class="op">$</span><span class="va">dat</span>, <span class="st">"CP effect size"</span> <span class="op">=</span> <span class="st">"Obs. at IA"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xxtheta1</span><span class="op">$</span><span class="va">dat</span>, <span class="st">"CP effect size"</span> <span class="op">=</span> <span class="st">"Alt. hypothesis"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot stage 2 sample size by design</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z1</span>, y <span class="op">=</span> <span class="va">n2</span>, col <span class="op">=</span> <span class="va">CP.effect.size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># compare power and expected sample size</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">Power.ssrCP</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu">Power.ssrCP</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xxtheta1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># combine data frames for the 2 designs</span></span></span>
<span class="r-in"><span><span class="va">y3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y1</span>, <span class="st">"CP effect size"</span> <span class="op">=</span> <span class="st">"Obs. at IA"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y2</span>, <span class="st">"CP effect size"</span> <span class="op">=</span> <span class="st">"Alt. hypothesis"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot expected sample size by design and effect size</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y3</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delta</span>, y <span class="op">=</span> <span class="va">en</span>, col <span class="op">=</span> <span class="va">CP.effect.size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Expected sample size"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># plot power by design and effect size</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y3</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delta</span>, y <span class="op">=</span> <span class="va">Power</span>, col <span class="op">=</span> <span class="va">CP.effect.size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ssrCP-7.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

