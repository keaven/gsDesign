<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Normal Density Grid — normalGrid • gsDesign</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Normal Density Grid — normalGrid" />
<meta property="og:description" content="normalGrid() is intended to be used for computation of the expected value of
a function of a normal random variable.  The function produces grid points
and weights to be used for numerical integration.
This is a utility function to provide a normal density function and a grid
to integrate over as described by Jennison and Turnbull (2000), Chapter 19.
While integration can be performed over the real line or over any portion of
it, the numerical integration does not extend beyond 6 standard deviations
from the mean. The grid used for integration uses equally spaced points over
the middle of the distribution function, and spreads points further apart in
the tails. The values returned in gridwgts may be used to integrate
any function over the given grid, although the user should take care that
the function integrated is not large in the tails of the grid where points
are spread further apart." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsDesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normal Density Grid</h1>
    
    <div class="hidden name"><code>normalGrid.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>normalGrid() is intended to be used for computation of the expected value of
a function of a normal random variable.  The function produces grid points
and weights to be used for numerical integration.</p>
<p>This is a utility function to provide a normal density function and a grid
to integrate over as described by Jennison and Turnbull (2000), Chapter 19.
While integration can be performed over the real line or over any portion of
it, the numerical integration does not extend beyond 6 standard deviations
from the mean. The grid used for integration uses equally spaced points over
the middle of the distribution function, and spreads points further apart in
the tails. The values returned in <code>gridwgts</code> may be used to integrate
any function over the given grid, although the user should take care that
the function integrated is not large in the tails of the grid where points
are spread further apart.</p>
    </div>

    <pre class="usage"><span class='fu'>normalGrid</span>(<span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>18</span>, <span class='kw'>bounds</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0</span>), <span class='kw'>mu</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>1</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>r</th>
      <td><p>Control for grid points as in Jennison and Turnbull (2000), Chapter
19; default is 18. Range: 1 to 80.  This might be changed by the user (e.g.,
<code>r=6</code> which produces 65 gridpoints compare to 185 points when
<code>r=18</code>) when speed is more important than precision.</p></td>
    </tr>
    <tr>
      <th>bounds</th>
      <td><p>Range of integration. Real-valued vector of length 2. Default
value of 0, 0 produces a range of + or - 6 standard deviations (6*sigma)
from the mean (=mu).</p></td>
    </tr>
    <tr>
      <th>mu</th>
      <td><p>Mean of the desired normal distribution.</p></td>
    </tr>
    <tr>
      <th>sigma</th>
      <td><p>Standard deviation of the desired normal distribution.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    

<dt>z</dt><dd><p>Grid points for numerical integration.</p></dd> <dt>density</dt><dd><p>The
standard normal density function evaluated at the values in <code>z</code>; see
examples.</p></dd> <dt>gridwgts</dt><dd><p>Simpson's rule weights for numerical integration
on the grid in <code>z</code>; see examples.</p></dd> <dt>wgts</dt><dd><p>Weights to be used with
the grid in <code>z</code> for integrating the normal density function; see
examples. This is equal to <code>density * gridwgts</code>.</p></dd>

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The manual is not linked to this help file, but is available in
library/gsdesign/doc/gsDesignManual.pdf in the directory where R is
installed.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Jennison C and Turnbull BW (2000), <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Boca Raton: Chapman and Hall.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ggplot2</span>)
<span class='co'>#  standard normal distribution</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>normalGrid</span>(<span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>x</span>$<span class='no'>z</span>, <span class='no'>x</span>$<span class='no'>wgts</span>)</div><div class='img'><img src='normalGrid-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#  verify that numerical integration replicates sigma</span>
<span class='co'>#  get grid points and weights</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>normalGrid</span>(<span class='kw'>mu</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>3</span>)

<span class='co'># compute squared deviation from mean for grid points</span>
<span class='no'>dev</span> <span class='kw'>&lt;-</span> (<span class='no'>x</span>$<span class='no'>z</span> - <span class='fl'>2</span>)^<span class='fl'>2</span>

<span class='co'># multiply squared deviations by integration weights and sum</span>
<span class='no'>sigma2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>dev</span> * <span class='no'>x</span>$<span class='no'>wgts</span>)

<span class='co'># square root of sigma2 should be sigma (3)</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>sigma2</span>)</div><div class='output co'>#&gt; [1] 3.000001</div><div class='input'>
<span class='co'># do it again with larger r to increase accuracy</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>normalGrid</span>(<span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>22</span>, <span class='kw'>mu</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>((<span class='no'>x</span>$<span class='no'>z</span> - <span class='fl'>2</span>)^<span class='fl'>2</span> * <span class='no'>x</span>$<span class='no'>wgts</span>))</div><div class='output co'>#&gt; [1] 3</div><div class='input'>
<span class='co'># this can also be done by combining gridwgts and density</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>((<span class='no'>x</span>$<span class='no'>z</span> - <span class='fl'>2</span>)^<span class='fl'>2</span> * <span class='no'>x</span>$<span class='no'>gridwgts</span> * <span class='no'>x</span>$<span class='no'>density</span>))</div><div class='output co'>#&gt; [1] 3</div><div class='input'>
<span class='co'># integrate normal density and compare to built-in function</span>
<span class='co'># to compute probability of being within 1 standard deviation</span>
<span class='co'># of the mean</span>
<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span>(<span class='fl'>1</span>) - <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span>(-<span class='fl'>1</span>)</div><div class='output co'>#&gt; [1] 0.6826895</div><div class='input'><span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>normalGrid</span>(<span class='kw'>bounds</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>1</span>, <span class='fl'>1</span>))
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>x</span>$<span class='no'>wgts</span>)</div><div class='output co'>#&gt; [1] 0.6826895</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>x</span>$<span class='no'>gridwgts</span> * <span class='no'>x</span>$<span class='no'>density</span>)</div><div class='output co'>#&gt; [1] 0.6826895</div><div class='input'>
<span class='co'># find expected sample size for default design with</span>
<span class='co'># n.fix=1000</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>n.fix</span> <span class='kw'>=</span> <span class='fl'>1000</span>)
<span class='no'>x</span></div><div class='output co'>#&gt; Asymmetric two-sided group sequential design with
#&gt; 90 % power and 2.5 % Type I Error.
#&gt; Upper bound spending computations assume
#&gt; trial continues if lower bound is crossed.
#&gt; 
#&gt;                   ----Lower bounds----  ----Upper bounds-----
#&gt;   Analysis   N    Z   Nominal p Spend+  Z   Nominal p Spend++
#&gt;          1  357 -0.24    0.4057 0.0148 3.01    0.0013  0.0013
#&gt;          2  714  0.94    0.8267 0.0289 2.55    0.0054  0.0049
#&gt;          3 1070  2.00    0.9772 0.0563 2.00    0.0228  0.0188
#&gt;      Total                      0.1000                 0.0250 
#&gt; + lower bound beta spending (under H1):
#&gt;  Hwang-Shih-DeCani spending function with gamma = -2.
#&gt; ++ alpha spending:
#&gt;  Hwang-Shih-DeCani spending function with gamma = -4.
#&gt; 
#&gt; Boundary crossing probabilities and expected sample size
#&gt; assume any cross stops the trial
#&gt; 
#&gt; Upper boundary (power or Type I Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3  Total  E{N}
#&gt;   0.0000 0.0013 0.0049 0.0171 0.0233 624.9
#&gt;   0.1025 0.1412 0.4403 0.3185 0.9000 791.3
#&gt; 
#&gt; Lower boundary (futility or Type II Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3  Total
#&gt;   0.0000 0.4057 0.4290 0.1420 0.9767
#&gt;   0.1025 0.0148 0.0289 0.0563 0.1000</div><div class='input'>
<span class='co'># set a prior distribution for theta</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>normalGrid</span>(<span class='kw'>r</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>mu</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>theta</span>[<span class='fl'>2</span>], <span class='kw'>sigma</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>theta</span>[<span class='fl'>2</span>] / <span class='fl'>1.5</span>)
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsProbability.html'>gsProbability</a></span>(
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>y</span>$<span class='no'>z</span>, <span class='kw'>n.I</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>n.I</span>, <span class='kw'>a</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>lower</span>$<span class='no'>bound</span>,
  <span class='kw'>b</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>
)
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsProbability.html'>gsProbability</a></span>(<span class='kw'>d</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>y</span>$<span class='no'>z</span>)
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(
  <span class='st'>"Expected sample size averaged over normal\n prior distribution for theta with \n mu="</span>,
  <span class='no'>x</span>$<span class='no'>theta</span>[<span class='fl'>2</span>], <span class='st'>"sigma="</span>, <span class='no'>x</span>$<span class='no'>theta</span>[<span class='fl'>2</span>] / <span class='fl'>1.5</span>, <span class='st'>":"</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>z</span>$<span class='no'>en</span> * <span class='no'>y</span>$<span class='no'>wgt</span>), <span class='fl'>1</span>), <span class='st'>"\n"</span>
)</div><div class='output co'>#&gt; Expected sample size averaged over normal
#&gt;  prior distribution for theta with 
#&gt;  mu= 0.1025057 sigma= 0.06833715 : 682.2 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>y</span>$<span class='no'>z</span>, <span class='no'>z</span>$<span class='no'>en</span>,
  <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"theta"</span>, <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"E{N}"</span>,
  <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"Expected sample size for different theta values"</span>
)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>y</span>$<span class='no'>z</span>, <span class='no'>z</span>$<span class='no'>en</span>)</div><div class='img'><img src='normalGrid-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


