<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Piecewise Linear and Step Function Spending Functions — sfLinear • gsDesign</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Piecewise Linear and Step Function Spending Functions — sfLinear" />
<meta property="og:description" content="The function sfLinear() allows specification of a piecewise linear
spending function. The function sfStep() specifies a step function
spending function. Both functions provide complete flexibility in setting
spending at desired timepoints in a group sequential design. Normally these
function will be passed to gsDesign() in the parameter sfu for
the upper bound or sfl for the lower bound to specify a spending
function family for a design. When passed to gsDesign(), the value of
param would be passed to sfLinear() or sfStep() through
the gsDesign() arguments sfupar for the upper bound and
sflpar for the lower bound.
Note that sfStep() allows setting a particular level of spending when
the timing is not strictly known; an example shows how this can inflate Type
I error when timing of analyses are changed based on knowing the treatment
effect at an interim." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsDesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Piecewise Linear and Step Function Spending Functions</h1>
    
    <div class="hidden name"><code>sfLinear.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>sfLinear()</code> allows specification of a piecewise linear
spending function. The function <code>sfStep()</code> specifies a step function
spending function. Both functions provide complete flexibility in setting
spending at desired timepoints in a group sequential design. Normally these
function will be passed to <code><a href='gsDesign.html'>gsDesign()</a></code> in the parameter <code>sfu</code> for
the upper bound or <code>sfl</code> for the lower bound to specify a spending
function family for a design. When passed to <code><a href='gsDesign.html'>gsDesign()</a></code>, the value of
<code>param</code> would be passed to <code>sfLinear()</code> or <code>sfStep()</code> through
the <code><a href='gsDesign.html'>gsDesign()</a></code> arguments <code>sfupar</code> for the upper bound and
<code>sflpar</code> for the lower bound.</p>
<p>Note that <code>sfStep()</code> allows setting a particular level of spending when
the timing is not strictly known; an example shows how this can inflate Type
I error when timing of analyses are changed based on knowing the treatment
effect at an interim.</p>
    </div>

    <pre class="usage"><span class='fu'>sfLinear</span>(<span class='no'>alpha</span>, <span class='no'>t</span>, <span class='no'>param</span>)

<span class='fu'>sfStep</span>(<span class='no'>alpha</span>, <span class='no'>t</span>, <span class='no'>param</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>alpha</th>
      <td><p>Real value \(&gt; 0\) and no more than 1. Normally,
<code>alpha=0.025</code> for one-sided Type I error specification or
<code>alpha=0.1</code> for Type II error specification. However, this could be set
to 1 if for descriptive purposes you wish to see the proportion of spending
as a function of the proportion of sample size or information.</p></td>
    </tr>
    <tr>
      <th>t</th>
      <td><p>A vector of points with increasing values from 0 to 1, inclusive.
Values of the proportion of sample size or information for which the
spending function will be computed.</p></td>
    </tr>
    <tr>
      <th>param</th>
      <td><p>A vector with a positive, even length. Values must range from 0
to 1, inclusive. Letting <code>m &lt;- length(param/2)</code>, the first <code>m</code>
points in param specify increasing values strictly between 0 and 1
corresponding to interim timing (proportion of final total statistical
information). The last <code>m</code> points in <code>param</code> specify
non-decreasing values from 0 to 1, inclusive, with the cumulative proportion
of spending at the specified timepoints.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of type <code>spendfn</code>.  The cumulative spending returned
in <code>sfLinear$spend</code> is 0 for <code>t &lt;= 0</code> and <code>alpha</code> for
<code>t&gt;=1</code>.  For <code>t</code> between specified points, linear interpolation is
used to determine <code>sfLinear$spend</code>.</p>
<p>The cumulative spending returned in <code>sfStep$spend</code> is 0 for
<code>t&lt;param[1]</code> and <code>alpha</code> for <code>t&gt;=1</code>.  Letting <code>m &lt;-
length(param/2)</code>, for <code>i=1,2,...m-1</code> and <code> param[i]&lt;= t &lt;
param[i+1]</code>, the cumulative spending is set at <code>alpha * param[i+m]</code>
(also for <code>param[m]&lt;=t&lt;1</code>).</p>
<p>Note that if <code>param[2m]</code> is 1, then the first time an analysis is
performed after the last proportion of final planned information
(<code>param[m]</code>) will be the final analysis, using any remaining error that
was not previously spent.</p>
<p>See <code><a href='Spending_Function_Overview.html'>Spending_Function_Overview</a></code> for further details.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The manual is not linked to this help file, but is available in
library/gsdesign/doc/gsDesignManual.pdf in the directory where R is
installed.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Jennison C and Turnbull BW (2000), <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Boca Raton: Chapman and Hall.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='Spending_Function_Overview.html'>Spending_Function_Overview</a>, <code><a href='gsDesign.html'>gsDesign</a></code>,
<a href='gsDesign-package-overview.html'>gsDesign package overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ggplot2</span>)
<span class='co'># set up alpha spending and beta spending to be piecewise linear</span>
<span class='no'>sfupar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.2</span>, <span class='fl'>.4</span>, <span class='fl'>.05</span>, <span class='fl'>.2</span>)
<span class='no'>sflpar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.3</span>, <span class='fl'>.5</span>, <span class='fl'>.65</span>, <span class='fl'>.5</span>, <span class='fl'>.75</span>, <span class='fl'>.9</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>sfu</span> <span class='kw'>=</span> <span class='no'>sfLinear</span>, <span class='kw'>sfl</span> <span class='kw'>=</span> <span class='no'>sfLinear</span>, <span class='kw'>sfupar</span> <span class='kw'>=</span> <span class='no'>sfupar</span>, <span class='kw'>sflpar</span> <span class='kw'>=</span> <span class='no'>sflpar</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>x</span>, <span class='kw'>plottype</span> <span class='kw'>=</span> <span class='st'>"sf"</span>)</div><div class='img'><img src='sfLinear-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>x</span></div><div class='output co'>#&gt; Asymmetric two-sided group sequential design with
#&gt; 90 % power and 2.5 % Type I Error.
#&gt; Upper bound spending computations assume
#&gt; trial continues if lower bound is crossed.
#&gt; 
#&gt;            Sample
#&gt;             Size   ----Lower bounds----  ----Upper bounds-----
#&gt;   Analysis Ratio*  Z   Nominal p Spend+  Z   Nominal p Spend++
#&gt;          1  0.474 0.63    0.7342 0.0542 2.67    0.0038  0.0038
#&gt;          2  0.948 1.60    0.9455 0.0363 2.27    0.0117  0.0101
#&gt;          3  1.422 2.11    0.9827 0.0095 2.11    0.0173  0.0111
#&gt;      Total                       0.1000                 0.0250 
#&gt; + lower bound beta spending (under H1):
#&gt;  Piecewise linear spending function with line points = 0.3 0.5 0.65 0.5 0.75 0.9.
#&gt; ++ alpha spending:
#&gt;  Piecewise linear spending function with line points = 0.2 0.4 0.05 0.2.
#&gt; * Sample size ratio compared to fixed design with no interim
#&gt; 
#&gt; Boundary crossing probabilities and expected sample size
#&gt; assume any cross stops the trial
#&gt; 
#&gt; Upper boundary (power or Type I Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3 Total   E{N}
#&gt;   0.0000 0.0038 0.0096 0.0056 0.019 0.6143
#&gt;   3.2415 0.3291 0.4762 0.0947 0.900 0.8155
#&gt; 
#&gt; Lower boundary (futility or Type II Error)
#&gt;           Analysis
#&gt;    Theta      1      2      3 Total
#&gt;   0.0000 0.7342 0.2181 0.0288 0.981
#&gt;   3.2415 0.0542 0.0363 0.0095 0.100</div><div class='input'>
<span class='co'># now do an example where there is no lower-spending at interim 1</span>
<span class='co'># and no upper spending at interim 2</span>
<span class='no'>sflpar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span> / <span class='fl'>3</span>, <span class='fl'>2</span> / <span class='fl'>3</span>, <span class='fl'>0</span>, <span class='fl'>.25</span>)
<span class='no'>sfupar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span> / <span class='fl'>3</span>, <span class='fl'>2</span> / <span class='fl'>3</span>, <span class='fl'>.1</span>, <span class='fl'>.1</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>sfu</span> <span class='kw'>=</span> <span class='no'>sfLinear</span>, <span class='kw'>sfl</span> <span class='kw'>=</span> <span class='no'>sfLinear</span>, <span class='kw'>sfupar</span> <span class='kw'>=</span> <span class='no'>sfupar</span>, <span class='kw'>sflpar</span> <span class='kw'>=</span> <span class='no'>sflpar</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>x</span>, <span class='kw'>plottype</span> <span class='kw'>=</span> <span class='st'>"sf"</span>)</div><div class='img'><img src='sfLinear-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>x</span></div><div class='output co'>#&gt; Asymmetric two-sided group sequential design with
#&gt; 90 % power and 2.5 % Type I Error.
#&gt; Upper bound spending computations assume
#&gt; trial continues if lower bound is crossed.
#&gt; 
#&gt;            Sample
#&gt;             Size    ----Lower bounds----  ----Upper bounds-----
#&gt;   Analysis Ratio*    Z   Nominal p Spend+   Z   Nominal p Spend++
#&gt;          1  0.343 -20.00    0.0000  0.000  2.81    0.0025  0.0025
#&gt;          2  0.685   0.72    0.7652  0.025 20.00    0.0000  0.0000
#&gt;          3  1.028   1.99    0.9765  0.075  1.99    0.0235  0.0225
#&gt;      Total                        0.1000                 0.0250 
#&gt; + lower bound beta spending (under H1):
#&gt;  Piecewise linear spending function with line points = 0.333333333333333 0.666666666666667 0 0.25.
#&gt; ++ alpha spending:
#&gt;  Piecewise linear spending function with line points = 0.333333333333333 0.666666666666667 0.1 0.1.
#&gt; * Sample size ratio compared to fixed design with no interim
#&gt; 
#&gt; Boundary crossing probabilities and expected sample size
#&gt; assume any cross stops the trial
#&gt; 
#&gt; Upper boundary (power or Type I Error)
#&gt;           Analysis
#&gt;    Theta      1 2      3  Total   E{N}
#&gt;   0.0000 0.0025 0 0.0219 0.0244 0.7638
#&gt;   3.2415 0.1814 0 0.7186 0.9000 0.8947
#&gt; 
#&gt; Lower boundary (futility or Type II Error)
#&gt;           Analysis
#&gt;    Theta 1      2      3  Total
#&gt;   0.0000 0 0.7651 0.2105 0.9756
#&gt;   3.2415 0 0.0250 0.0750 0.1000</div><div class='input'>
<span class='co'># now do an example where timing of interims changes slightly, but error spending does not</span>
<span class='co'># also, spend all alpha when at least &gt;=90 percent of final information is in the analysis</span>
<span class='no'>sfupar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.2</span>, <span class='fl'>.4</span>, <span class='fl'>.9</span>, ((<span class='fl'>1</span>:<span class='fl'>3</span>) / <span class='fl'>3</span>)^<span class='fl'>3</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>n.fix</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>sfu</span> <span class='kw'>=</span> <span class='no'>sfStep</span>, <span class='kw'>sfupar</span> <span class='kw'>=</span> <span class='no'>sfupar</span>, <span class='kw'>test.type</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>x</span>, <span class='kw'>pl</span> <span class='kw'>=</span> <span class='st'>"sf"</span>)</div><div class='img'><img src='sfLinear-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># original planned sample sizes</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='no'>x</span>$<span class='no'>n.I</span>)</div><div class='output co'>#&gt; [1]  34  68 102</div><div class='input'><span class='co'># cumulative spending planned at original interims</span>
<span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span>(<span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>spend</span>)</div><div class='output co'>#&gt; [1] 0.0009259259 0.0074074074 0.0250000000</div><div class='input'><span class='co'># change timing of analyses;</span>
<span class='co'># note that cumulative spending "P(Cross) if delta=0" does not change from cumsum(x$upper$spend)</span>
<span class='co'># while full alpha is spent, power is reduced by reduced sample size</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>sfu</span> <span class='kw'>=</span> <span class='no'>sfStep</span>, <span class='kw'>sfupar</span> <span class='kw'>=</span> <span class='no'>sfupar</span>, <span class='kw'>test.type</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>maxn.IPlan</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>n.I</span>[<span class='no'>x</span>$<span class='no'>k</span>], <span class='kw'>n.I</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>30</span>, <span class='fl'>70</span>, <span class='fl'>95</span>),
  <span class='kw'>n.fix</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>n.fix</span>
)
<span class='co'># note that full alpha is used, but power is reduced due to lowered sample size</span>
<span class='fu'><a href='gsBoundSummary.html'>gsBoundSummary</a></span>(<span class='no'>y</span>)</div><div class='output co'>#&gt;   Analysis               Value Efficacy
#&gt;  IA 1: 29%                   Z   3.1130
#&gt;      N: 30         p (1-sided)   0.0009
#&gt;                ~delta at bound   1.7534
#&gt;            P(Cross) if delta=0   0.0009
#&gt;            P(Cross) if delta=1   0.0905
#&gt;  IA 2: 69%                   Z   2.4662
#&gt;      N: 70         p (1-sided)   0.0068
#&gt;                ~delta at bound   0.9094
#&gt;            P(Cross) if delta=0   0.0074
#&gt;            P(Cross) if delta=1   0.6004
#&gt;      Final                   Z   1.9975
#&gt;      N: 95         p (1-sided)   0.0229
#&gt;                ~delta at bound   0.6322
#&gt;            P(Cross) if delta=0   0.0250
#&gt;            P(Cross) if delta=1   0.8807</div><div class='input'>
<span class='co'># now show how step function can be abused by 'adapting' stage 2 sample size based on interim result</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gsDesign.html'>gsDesign</a></span>(<span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>delta</span> <span class='kw'>=</span> <span class='fl'>.05</span>, <span class='kw'>sfu</span> <span class='kw'>=</span> <span class='no'>sfStep</span>, <span class='kw'>sfupar</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.02</span>, <span class='fl'>.001</span>), <span class='kw'>timing</span> <span class='kw'>=</span> <span class='fl'>.02</span>, <span class='kw'>test.type</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='co'># spending jumps from miniscule to full alpha at first analysis after interim 1</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>x</span>, <span class='kw'>pl</span> <span class='kw'>=</span> <span class='st'>"sf"</span>)</div><div class='img'><img src='sfLinear-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># sample sizes at analyses:</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='no'>x</span>$<span class='no'>n.I</span>)</div><div class='output co'>#&gt; [1]   85 4204</div><div class='input'><span class='co'># simulate 1 million stage 1 sum of 178 Normal(0,1) random variables</span>
<span class='co'># Normal(0,Variance=178) under null hypothesis</span>
<span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>1000000</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span>))
<span class='co'># compute corresponding z-values</span>
<span class='no'>z1</span> <span class='kw'>&lt;-</span> <span class='no'>s1</span> / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span>)
<span class='co'># set stage 2 sample size to 1 if z1 is over final bound, otherwise full sample size</span>
<span class='no'>n2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fl'>1000000</span>)
<span class='no'>n2</span>[<span class='no'>z1</span> <span class='kw'>&lt;</span> <span class='fl'>1.96</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='no'>x</span>$<span class='no'>n.I</span>[<span class='fl'>2</span>]) - <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='fl'>178</span>)
<span class='co'># now sample n2 observations for second stage</span>
<span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>1000000</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>n2</span>))
<span class='co'># add sum and divide by standard deviation</span>
<span class='no'>z2</span> <span class='kw'>&lt;-</span> (<span class='no'>s1</span> + <span class='no'>s2</span>) / (<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span> + <span class='no'>n2</span>))
<span class='co'># By allowing full spending when final analysis is either</span>
<span class='co'># early or late depending on observed interim z1,</span>
<span class='co'># Type I error is now almost twice the planned .025</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>z1</span> <span class='kw'>&gt;=</span> <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>1</span>] <span class='kw'>|</span> <span class='no'>z2</span> <span class='kw'>&gt;=</span> <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>2</span>]) / <span class='fl'>1000000</span></div><div class='output co'>#&gt; [1] 0.046449</div><div class='input'><span class='co'># if stage 2 sample size is random and independent of z1 with same frequency,</span>
<span class='co'># this is not a problem</span>
<span class='no'>s1alt</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>1000000</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span>))
<span class='no'>z1alt</span> <span class='kw'>&lt;-</span> <span class='no'>s1alt</span> / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span>)
<span class='no'>z2alt</span> <span class='kw'>&lt;-</span> (<span class='no'>s1alt</span> + <span class='no'>s2</span>) / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>178</span> + <span class='no'>n2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>z1alt</span> <span class='kw'>&gt;=</span> <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>1</span>] <span class='kw'>|</span> <span class='no'>z2alt</span> <span class='kw'>&gt;=</span> <span class='no'>x</span>$<span class='no'>upper</span>$<span class='no'>bound</span>[<span class='fl'>2</span>]) / <span class='fl'>1000000</span></div><div class='output co'>#&gt; [1] 0.024672</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


