<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Piecewise Linear and Step Function Spending Functions — sfLinear • gsDesign</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Piecewise Linear and Step Function Spending Functions — sfLinear"><meta name="description" content="The function sfLinear() allows specification of a piecewise linear
spending function. The function sfStep() specifies a step function
spending function. Both functions provide complete flexibility in setting
spending at desired timepoints in a group sequential design. Normally these
function will be passed to gsDesign() in the parameter sfu for
the upper bound or sfl for the lower bound to specify a spending
function family for a design. When passed to gsDesign(), the value of
param would be passed to sfLinear() or sfStep() through
the gsDesign() arguments sfupar for the upper bound and
sflpar for the lower bound.
Note that sfStep() allows setting a particular level of spending when
the timing is not strictly known; an example shows how this can inflate Type
I error when timing of analyses are changed based on knowing the treatment
effect at an interim."><meta property="og:description" content="The function sfLinear() allows specification of a piecewise linear
spending function. The function sfStep() specifies a step function
spending function. Both functions provide complete flexibility in setting
spending at desired timepoints in a group sequential design. Normally these
function will be passed to gsDesign() in the parameter sfu for
the upper bound or sfl for the lower bound to specify a spending
function family for a design. When passed to gsDesign(), the value of
param would be passed to sfLinear() or sfStep() through
the gsDesign() arguments sfupar for the upper bound and
sflpar for the lower bound.
Note that sfStep() allows setting a particular level of spending when
the timing is not strictly known; an example shows how this can inflate Type
I error when timing of analyses are changed based on knowing the treatment
effect at an interim."><meta property="og:image" content="https://keaven.github.io/gsDesign/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Piecewise Linear and Step Function Spending Functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesign/blob/master/R/gsSpending.R" class="external-link"><code>R/gsSpending.R</code></a></small>
      <div class="d-none name"><code>sfLinear.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>sfLinear()</code> allows specification of a piecewise linear
spending function. The function <code>sfStep()</code> specifies a step function
spending function. Both functions provide complete flexibility in setting
spending at desired timepoints in a group sequential design. Normally these
function will be passed to <code><a href="gsDesign.html">gsDesign()</a></code> in the parameter <code>sfu</code> for
the upper bound or <code>sfl</code> for the lower bound to specify a spending
function family for a design. When passed to <code><a href="gsDesign.html">gsDesign()</a></code>, the value of
<code>param</code> would be passed to <code>sfLinear()</code> or <code>sfStep()</code> through
the <code><a href="gsDesign.html">gsDesign()</a></code> arguments <code>sfupar</code> for the upper bound and
<code>sflpar</code> for the lower bound.</p>
<p>Note that <code>sfStep()</code> allows setting a particular level of spending when
the timing is not strictly known; an example shows how this can inflate Type
I error when timing of analyses are changed based on knowing the treatment
effect at an interim.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sfLinear</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">t</span>, <span class="va">param</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sfStep</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">t</span>, <span class="va">param</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Real value \(&gt; 0\) and no more than 1. Normally,
<code>alpha=0.025</code> for one-sided Type I error specification or
<code>alpha=0.1</code> for Type II error specification. However, this could be set
to 1 if for descriptive purposes you wish to see the proportion of spending
as a function of the proportion of sample size or information.</p></dd>


<dt id="arg-t">t<a class="anchor" aria-label="anchor" href="#arg-t"></a></dt>
<dd><p>A vector of points with increasing values from 0 to 1, inclusive.
Values of the proportion of sample size or information for which the
spending function will be computed.</p></dd>


<dt id="arg-param">param<a class="anchor" aria-label="anchor" href="#arg-param"></a></dt>
<dd><p>A vector with a positive, even length. Values must range from 0
to 1, inclusive. Letting <code>m &lt;- length(param/2)</code>, the first <code>m</code>
points in param specify increasing values strictly between 0 and 1
corresponding to interim timing (proportion of final total statistical
information). The last <code>m</code> points in <code>param</code> specify
non-decreasing values from 0 to 1, inclusive, with the cumulative proportion
of spending at the specified timepoints.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of type <code>spendfn</code>.  The cumulative spending returned
in <code>sfLinear$spend</code> is 0 for <code>t &lt;= 0</code> and <code>alpha</code> for
<code>t&gt;=1</code>.  For <code>t</code> between specified points, linear interpolation is
used to determine <code>sfLinear$spend</code>.</p>
<p>The cumulative spending returned in <code>sfStep$spend</code> is 0 for
<code>t&lt;param[1]</code> and <code>alpha</code> for <code>t&gt;=1</code>.  Letting <code>m &lt;-
length(param/2)</code>, for <code>i=1,2,...m-1</code> and <code> param[i]&lt;= t &lt;
param[i+1]</code>, the cumulative spending is set at <code>alpha * param[i+m]</code>
(also for <code>param[m]&lt;=t&lt;1</code>).</p>
<p>Note that if <code>param[2m]</code> is 1, then the first time an analysis is
performed after the last proportion of final planned information
(<code>param[m]</code>) will be the final analysis, using any remaining error that
was not previously spent.</p>
<p>See <code><a href="../articles/SpendingFunctionOverview.html">vignette("SpendingFunctionOverview")</a></code> for further details.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The gsDesign technical manual is available at
  <a href="https://keaven.github.io/gsd-tech-manual/" class="external-link">https://keaven.github.io/gsd-tech-manual/</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jennison C and Turnbull BW (2000), <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Boca Raton: Chapman and Hall.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="../articles/SpendingFunctionOverview.html">vignette("SpendingFunctionOverview")</a></code>, <code><a href="gsDesign.html">gsDesign</a></code>,
<code><a href="../articles/gsDesignPackageOverview.html">vignette("gsDesignPackageOverview")</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Keaven Anderson <a href="mailto:keaven_anderson@merck.com">keaven_anderson@merck.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># set up alpha spending and beta spending to be piecewise linear</span></span></span>
<span class="r-in"><span><span class="va">sfupar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.05</span>, <span class="fl">.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sflpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.5</span>, <span class="fl">.65</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="fl">.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>sfu <span class="op">=</span> <span class="va">sfLinear</span>, sfl <span class="op">=</span> <span class="va">sfLinear</span>, sfupar <span class="op">=</span> <span class="va">sfupar</span>, sflpar <span class="op">=</span> <span class="va">sflpar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plottype <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sfLinear-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Asymmetric two-sided group sequential design with</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90 % power and 2.5 % Type I Error.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Upper bound spending computations assume</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trial continues if lower bound is crossed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Size   ----Lower bounds----  ----Upper bounds-----</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Analysis Ratio*  Z   Nominal p Spend+  Z   Nominal p Spend++</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1  0.474 0.63    0.7342 0.0542 2.67    0.0038  0.0037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          2  0.948 1.60    0.9455 0.0363 2.27    0.0117  0.0101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          3  1.422 2.11    0.9827 0.0095 2.11    0.0173  0.0111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Total                       0.1000                 0.0250 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> + lower bound beta spending (under H1):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Piecewise linear spending function with line points = 0.3, line points = 0.5, line points = 0.65, line points = 0.5, line points = 0.75, line points = 0.9.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ++ alpha spending:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Piecewise linear spending function with line points = 0.2, line points = 0.4, line points = 0.05, line points = 0.2.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Sample size ratio compared to fixed design with no interim</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary crossing probabilities and expected sample size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> assume any cross stops the trial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Upper boundary (power or Type I Error)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Theta      1      2      3 Total   E{N}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0000 0.0038 0.0096 0.0056 0.019 0.6143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.2415 0.3291 0.4762 0.0947 0.900 0.8155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower boundary (futility or Type II Error)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Theta      1      2      3 Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0000 0.7342 0.2181 0.0288 0.981</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.2415 0.0542 0.0363 0.0095 0.100</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now do an example where there is no lower-spending at interim 1</span></span></span>
<span class="r-in"><span><span class="co"># and no upper spending at interim 2</span></span></span>
<span class="r-in"><span><span class="va">sflpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">.25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sfupar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>sfu <span class="op">=</span> <span class="va">sfLinear</span>, sfl <span class="op">=</span> <span class="va">sfLinear</span>, sfupar <span class="op">=</span> <span class="va">sfupar</span>, sflpar <span class="op">=</span> <span class="va">sflpar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plottype <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sfLinear-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Asymmetric two-sided group sequential design with</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90 % power and 2.5 % Type I Error.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Upper bound spending computations assume</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trial continues if lower bound is crossed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Size    ----Lower bounds----  ----Upper bounds-----</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Analysis Ratio*    Z   Nominal p Spend+   Z   Nominal p Spend++</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1  0.343 -20.00    0.0000  0.000  2.81    0.0025  0.0025</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          2  0.685   0.72    0.7652  0.025 20.00    0.0000  0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          3  1.028   1.99    0.9765  0.075  1.99    0.0235  0.0225</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Total                        0.1000                 0.0250 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> + lower bound beta spending (under H1):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Piecewise linear spending function with line points = 0.33333, line points = 0.66667, line points = 0, line points = 0.25.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ++ alpha spending:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Piecewise linear spending function with line points = 0.33333, line points = 0.66667, line points = 0.1, line points = 0.1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Sample size ratio compared to fixed design with no interim</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary crossing probabilities and expected sample size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> assume any cross stops the trial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Upper boundary (power or Type I Error)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Theta      1 2      3  Total   E{N}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0000 0.0025 0 0.0219 0.0244 0.7638</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.2415 0.1814 0 0.7186 0.9000 0.8947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lower boundary (futility or Type II Error)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Theta 1      2      3  Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.0000 0 0.7651 0.2105 0.9756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.2415 0 0.0250 0.0750 0.1000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now do an example where timing of interims changes slightly, but error spending does not</span></span></span>
<span class="r-in"><span><span class="co"># also, spend all alpha when at least &gt;=90 percent of final information is in the analysis</span></span></span>
<span class="r-in"><span><span class="va">sfupar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.9</span>, <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">3</span>, n.fix <span class="op">=</span> <span class="fl">100</span>, sfu <span class="op">=</span> <span class="va">sfStep</span>, sfupar <span class="op">=</span> <span class="va">sfupar</span>, test.type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, pl <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sfLinear-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># original planned sample sizes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  34  68 102</span>
<span class="r-in"><span><span class="co"># cumulative spending planned at original interims</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">spend</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0009259259 0.0074074074 0.0250000000</span>
<span class="r-in"><span><span class="co"># change timing of analyses;</span></span></span>
<span class="r-in"><span><span class="co"># note that cumulative spending "P(Cross) if delta=0" does not change from cumsum(x$upper$spend)</span></span></span>
<span class="r-in"><span><span class="co"># while full alpha is spent, power is reduced by reduced sample size</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  k <span class="op">=</span> <span class="fl">3</span>, sfu <span class="op">=</span> <span class="va">sfStep</span>, sfupar <span class="op">=</span> <span class="va">sfupar</span>, test.type <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  maxn.IPlan <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">k</span><span class="op">]</span>, n.I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">70</span>, <span class="fl">95</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  n.fix <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">n.fix</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># note that full alpha is used, but power is reduced due to lowered sample size</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gsBoundSummary.html">gsBoundSummary</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Analysis               Value Efficacy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  IA 1: 29%                   Z   3.1130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      N: 30         p (1-sided)   0.0009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                ~delta at bound   1.7534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=0   0.0009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=1   0.0905</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  IA 2: 69%                   Z   2.4662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      N: 70         p (1-sided)   0.0068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                ~delta at bound   0.9094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=0   0.0074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=1   0.6004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Final                   Z   1.9975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      N: 95         p (1-sided)   0.0229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                ~delta at bound   0.6322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=0   0.0250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            P(Cross) if delta=1   0.8807</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now show how step function can be abused by 'adapting' stage 2 sample size based on interim result</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, delta <span class="op">=</span> <span class="fl">.05</span>, sfu <span class="op">=</span> <span class="va">sfStep</span>, sfupar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.001</span><span class="op">)</span>, timing <span class="op">=</span> <span class="fl">.02</span>, test.type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># spending jumps from miniscule to full alpha at first analysis after interim 1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, pl <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sfLinear-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># sample sizes at analyses:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]   85 4204</span>
<span class="r-in"><span><span class="co"># simulate 1 million stage 1 sum of 178 Normal(0,1) random variables</span></span></span>
<span class="r-in"><span><span class="co"># Normal(0,Variance=178) under null hypothesis</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># compute corresponding z-values</span></span></span>
<span class="r-in"><span><span class="va">z1</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># set stage 2 sample size to 1 if z1 is over final bound, otherwise full sample size</span></span></span>
<span class="r-in"><span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n2</span><span class="op">[</span><span class="va">z1</span> <span class="op">&lt;</span> <span class="fl">1.96</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">n.I</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fl">178</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># now sample n2 observations for second stage</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># add sum and divide by standard deviation</span></span></span>
<span class="r-in"><span><span class="va">z2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">s1</span> <span class="op">+</span> <span class="va">s2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span> <span class="op">+</span> <span class="va">n2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># By allowing full spending when final analysis is either</span></span></span>
<span class="r-in"><span><span class="co"># early or late depending on observed interim z1,</span></span></span>
<span class="r-in"><span><span class="co"># Type I error is now almost twice the planned .025</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z1</span> <span class="op">&gt;=</span> <span class="va">x</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="va">z2</span> <span class="op">&gt;=</span> <span class="va">x</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000000</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.046808</span>
<span class="r-in"><span><span class="co"># if stage 2 sample size is random and independent of z1 with same frequency,</span></span></span>
<span class="r-in"><span><span class="co"># this is not a problem</span></span></span>
<span class="r-in"><span><span class="va">s1alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z1alt</span> <span class="op">&lt;-</span> <span class="va">s1alt</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z2alt</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">s1alt</span> <span class="op">+</span> <span class="va">s2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">178</span> <span class="op">+</span> <span class="va">n2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z1alt</span> <span class="op">&gt;=</span> <span class="va">x</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="va">z2alt</span> <span class="op">&gt;=</span> <span class="va">x</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000000</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.025279</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

