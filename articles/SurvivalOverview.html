<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Overview of survival endpoint design • gsDesign</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Overview of survival endpoint design">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Overview of survival endpoint design</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesign/blob/master/vignettes/SurvivalOverview.Rmd" class="external-link"><code>vignettes/SurvivalOverview.Rmd</code></a></small>
      <div class="d-none name"><code>SurvivalOverview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article/vignette provides a summary of functions in the
<strong><em>gsDesign</em></strong> package supporting design and
evaluation of trial designs for time-to-event outcomes. We do not focus
on detailed output options, but what numbers summarizing the design are
based on. If you are not looking for this level of detail and just want
to see how to design a fixed or group sequential design for a
time-to-event endpoint, see the vignette <em>Basic time-to-event group
sequential design using gsSurv</em>.</p>
<p>The following functions support use of the very straightforward <span class="citation">Schoenfeld (1981)</span> approximation for 2-arm
trials:</p>
<ul>
<li>
<code><a href="../reference/nSurvival.html">nEvents()</a></code>: number of events to achieve power or power
given number of events with no interim analysis.</li>
<li>
<code><a href="../reference/nSurvival.html">zn2hr()</a></code>: approximate the observed hazard ratio (HR)
required to achieve a targeted Z-value for a given number of
events.</li>
<li>
<code><a href="../reference/nSurvival.html">hrn2z()</a></code>: approximate Z-value corresponding to a
specified HR and event count.</li>
<li>
<code><a href="../reference/nSurvival.html">hrz2n()</a></code>: approximate event count corresponding to a
specified HR and Z-value.</li>
</ul>
<p>The above functions do not directly support sample size calculations.
This is done with the <span class="citation">Lachin and Foulkes
(1986)</span> method. Functions include:</p>
<ul>
<li>
<code><a href="../reference/nSurv.html">nSurv()</a></code>: More flexible enrollment scenarios; single
analysis.</li>
<li>
<code><a href="../reference/nSurv.html">gsSurv()</a></code>: Group sequential design extension of
<code><a href="../reference/nSurv.html">nSurv()</a></code>.</li>
<li>
<code><a href="../reference/nSurvival.html">nSurvival()</a></code>: Sample size restricted to single
enrollment rate, single analysis; this has been effectively replaced and
generalized by <code><a href="../reference/nSurv.html">nSurv()</a></code> and <code><a href="../reference/nSurv.html">gsSurv()</a></code>.</li>
</ul>
<p>Output for survival design information is supported in various
formats:</p>
<ul>
<li>
<code><a href="../reference/gsBoundSummary.html">gsBoundSummary()</a></code>: Tabular summary of a design in a data
frame.</li>
<li>
<code><a href="../reference/plot.gsDesign.html">plot.gsDesign()</a></code>: Various plot summaries of a
design.</li>
<li>
<code><a href="../reference/gsBoundSummary.html">gsHR()</a></code>: Approximate HR required to cross a bound.</li>
</ul>
</div>
<div class="section level2">
<h2 id="schoenfeld-approximation-support">Schoenfeld approximation support<a class="anchor" aria-label="anchor" href="#schoenfeld-approximation-support"></a>
</h2>
<p>We will assume a hazard ratio <span class="math inline">\nu &lt;
1</span> represents a benefit of experimental treatment over control. We
let <span class="math inline">\delta = \log\nu</span> denote the
so-called <em>natural parameter</em> for this case. Asymptotically the
distribution of the Cox model estimate <span class="math inline">\hat{\delta}</span> under the proportional hazards
assumption is (<span class="citation">Schoenfeld (1981)</span>) <span class="math display">\hat\delta\sim \text{Normal}(\delta=\log\nu,
(1+r)^2/nr).</span> The inverse of the variance is the statistical
information: <span class="math display">\mathcal I = nr/(1 +
r)^2.</span> Using a Cox model to estimate <span class="math inline">\delta</span>, the Wald test for <span class="math inline">\text{H}_0: \delta=0</span> can be approximated with
the asymptotic variance from above as:</p>
<p><span class="math display">Z_W\approx \frac{\sqrt
{nr}}{1+r}\hat\delta=\frac{\ln(\hat\nu)\sqrt{nr}}{1+r}.</span></p>
<p>Also, we know that the Wald test <span class="math inline">Z_W</span>
and a standard normal version of the logrank <span class="math inline">Z</span> are both asymptotically efficient and
therefore asymptotically equivalent, at least under a local hypothesis
framework. We denote the <em>standardized effect size</em> as</p>
<p><span class="math display">\theta = \delta\sqrt r / (1+r)=
\log(\nu)\sqrt r / (1+r).</span> Letting <span class="math inline">\hat\theta = -\sqrt r/(1+r)\hat\delta</span> and
<span class="math inline">n</span> representing the number of events
observed, we have <span class="math display">\hat \theta \sim
\text{Normal}(\theta, 1/ n).</span> Thus, the standardized Z version of
the logrank is approximately distributed as</p>
<p><span class="math display">Z\sim\text{Normal}(\sqrt
n\theta,1).</span> Treatment effect favoring experimental treatment
compared to control in this notation corresponds to a hazard ratio <span class="math inline">\nu &lt; 1</span>, as well as negative values of the
standardized effect <span class="math inline">\theta</span>, natural
parameter <span class="math inline">\delta</span> and standardized
Z-test.</p>
<div class="section level3">
<h3 id="power-and-sample-size-with-nevents">Power and sample size with <code>nEvents()</code><a class="anchor" aria-label="anchor" href="#power-and-sample-size-with-nevents"></a>
</h3>
<p>Based on the above, the power for the logrank test when <span class="math inline">n</span> events have been observed is approximated
by</p>
<p><span class="math display">P[Z\le z]=\Phi(z -\sqrt n\theta)=\Phi(z-
\sqrt{nr}/(1+r)\log\nu).</span> Thus, assuming <span class="math inline">n=100</span> events and <span class="math inline">\delta = \log\nu=-\log(.7)</span>, and <span class="math inline">r=1</span> (equal randomization) we approximate
power for the logrank test when <span class="math inline">\alpha=0.025</span> as</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">.7</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">.025</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4299155</span></span></code></pre></div>
<p>We can compute this with <code><a href="../reference/nSurvival.html">gsDesign::nEvents()</a></code> as:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nSurvival.html">nEvents</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, hr <span class="op">=</span> <span class="va">hr</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4299155</span></span></code></pre></div>
<p>We solve for the number of events <span class="math inline">n</span>
to see how many events are required to obtain a desired power</p>
<p><span class="math display">1-\beta=P(Z\ge \Phi^{-1}(1-\alpha))</span>
with</p>
<p><span class="math display">n = \left(\frac{\Phi^{-1}
(1-\alpha)+\Phi^{-1}(1-\beta)}{\theta}\right)^2
=\frac{(1+r)^2}{r(\log\nu)^2}\left({\Phi^{-1}
(1-\alpha)+\Phi^{-1}(1-\beta)}\right)^2.</span> Thus, the approximate
number of events required to power for HR=0.7 with <span class="math inline">\alpha=0.025</span> one-sided and power <span class="math inline">1-\beta=0.9</span> is</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">r</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="co">#&gt; [1] 330.3779</span></span></code></pre></div>
<p>which, rounding up, matches (with tabular output):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nSurvival.html">nEvents</a></span><span class="op">(</span>hr <span class="op">=</span> <span class="va">hr</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, r <span class="op">=</span> <span class="fl">1</span>, tbl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">hr</th>
<th align="right">n</th>
<th align="right">alpha</th>
<th align="right">sided</th>
<th align="right">beta</th>
<th align="right">Power</th>
<th align="right">delta</th>
<th align="right">ratio</th>
<th align="right">hr0</th>
<th align="right">se</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.7</td>
<td align="right">331</td>
<td align="right">0.025</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">0.9</td>
<td align="right">0.1783375</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.1099299</td>
</tr></tbody>
</table>
<p>The notation <code>delta</code> in the above table changes the sign
for the standardized treatment effect <span class="math inline">\theta</span> in the above:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">delta</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="va">theta</span></span>
<span><span class="co">#&gt; [1] -0.1783375</span></span></code></pre></div>
<p>The <code>se</code> in the table is the estimated standard error for
the log hazard ratio <span class="math inline">\delta=\log\hat\nu</span></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">331</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1099299</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="group-sequential-design">Group sequential design<a class="anchor" aria-label="anchor" href="#group-sequential-design"></a>
</h3>
<p>We can create a group sequential design for the above problem either
with <span class="math inline">\theta</span> or with the fixed design
sample size. The parameter <code>delta</code> in <code><a href="../reference/gsDesign.html">gsDesign()</a></code>
corresponds to standardized effect size with sign changed <span class="math inline">-\theta</span> in notation used above and by <span class="citation">Jennison and Turnbull (2000)</span>, while the natural
parameter, <span class="math inline">\log(\text{HR})</span> is in the
parameter <code>delta1</code> passed to <code><a href="../reference/gsDesign.html">gsDesign()</a></code>. The
name of the effect size is specified in <code>deltaname</code> and the
parameter <code>logdelta = TRUE</code> indicates that <code>delta</code>
input needs to be exponentiated to obtain HR in the output below. This
example code can be useful in practice. We begin by passing the number
of events for a fixed design in the parameter <code>n.fix</code>
(continuous, not rounded) to adapt to a group sequential design. By
rounding to integer event counts with the <code><a href="../reference/toInteger.html">toInteger()</a></code>
function we increase the power slightly over the targeted 90%.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Schoenfeld</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gsDesign.html">gsDesign</a></span><span class="op">(</span></span>
<span>  k <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n.fix <span class="op">=</span> <span class="fu"><a href="../reference/nSurvival.html">nEvents</a></span><span class="op">(</span>hr <span class="op">=</span> <span class="va">hr</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  delta1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/toInteger.html">toInteger</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Schoenfeld</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gsBoundSummary.html">gsBoundSummary</a></span><span class="op">(</span>deltaname <span class="op">=</span> <span class="st">"HR"</span>, logdelta <span class="op">=</span> <span class="cn">TRUE</span>, Nname <span class="op">=</span> <span class="st">"Events"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Analysis</th>
<th align="left">Value</th>
<th align="right">Efficacy</th>
<th align="right">Futility</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">IA 1: 50%</td>
<td align="left">Z</td>
<td align="right">2.7522</td>
<td align="right">0.4084</td>
</tr>
<tr class="even">
<td align="left">Events: 172</td>
<td align="left">p (1-sided)</td>
<td align="right">0.0030</td>
<td align="right">0.3415</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">~HR at bound</td>
<td align="right">0.6572</td>
<td align="right">0.9396</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">P(Cross) if HR=1</td>
<td align="right">0.0030</td>
<td align="right">0.6585</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">P(Cross) if HR=0.7</td>
<td align="right">0.3397</td>
<td align="right">0.0268</td>
</tr>
<tr class="even">
<td align="left">Final</td>
<td align="left">Z</td>
<td align="right">1.9810</td>
<td align="right">1.9810</td>
</tr>
<tr class="odd">
<td align="left">Events: 345</td>
<td align="left">p (1-sided)</td>
<td align="right">0.0238</td>
<td align="right">0.0238</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">~HR at bound</td>
<td align="right">0.8079</td>
<td align="right">0.8079</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">P(Cross) if HR=1</td>
<td align="right">0.0239</td>
<td align="right">0.9761</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">P(Cross) if HR=0.7</td>
<td align="right">0.9004</td>
<td align="right">0.0996</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="information-based-design">Information based design<a class="anchor" aria-label="anchor" href="#information-based-design"></a>
</h3>
<p>Exactly the same result can be obtained with the following, passing
the standardized effect size <code>theta</code> from above to the
parameter <code>delta</code> in <code><a href="../reference/gsDesign.html">gsDesign()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Schoenfeld</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, delta <span class="op">=</span> <span class="op">-</span><span class="va">theta</span>, delta1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/toInteger.html">toInteger</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We noted above that the asymptotic variance for <span class="math inline">\hat\theta</span> is <span class="math inline">1/n</span> which corresponds to statistical
information <span class="math inline">\mathcal I=n</span> for the
parameter <span class="math inline">\theta</span>. Thus, the value</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Schoenfeld</span><span class="op">$</span><span class="va">n.I</span></span>
<span><span class="co">#&gt; [1] 172 345</span></span></code></pre></div>
<p>corresponds both to the number of events and the statistical
information for the standardized effect size <span class="math inline">\theta</span> required to power the trial at the
desired level. Note that if you plug in the natural parameter <span class="math inline">\delta= -\log\nu &gt; 0</span>, then <span class="math inline">n.I</span> returns the statistical information for
the log hazard ratio.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gsDesign.html">gsDesign</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, delta <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">n.I</span></span>
<span><span class="co">#&gt; [1] 43.06893 86.13786</span></span></code></pre></div>
<p>The reader may wish to look above to derive the exact relationship
between events and statistical information for <span class="math inline">\delta</span>.</p>
</div>
<div class="section level3">
<h3 id="approximating-boundary-characteristics">Approximating boundary characteristics<a class="anchor" aria-label="anchor" href="#approximating-boundary-characteristics"></a>
</h3>
<p>Another application of the <span class="citation">Schoenfeld
(1981)</span> method is to approximate boundary characteristics of a
design. We will consider <code><a href="../reference/nSurvival.html">zn2hr()</a></code>, <code><a href="../reference/gsBoundSummary.html">gsHR()</a></code> and
<code><a href="../reference/gsBoundSummary.html">gsBoundSummary()</a></code> to approximate the treatment effect
required to cross design bounds. <code><a href="../reference/nSurvival.html">zn2hr()</a></code> is complemented by
the functions <code><a href="../reference/nSurvival.html">hrn2z()</a></code> and <code><a href="../reference/nSurvival.html">hrz2n()</a></code>. We begin
with the basic approximation used across all of these functions in this
section and follow with a sub-section with example code to reproduce
some of what is in the table above.</p>
<p>We return to the following equation from above:</p>
<p><span class="math display">Z\approx Z_W\approx \frac{\sqrt
{nr}}{1+r}\hat\delta=\frac{\ln(\hat\nu)\sqrt{nr}}{1+r}.</span> By fixing
<span class="math inline">Z=z, n</span> we can solve for <span class="math inline">\hat\nu</span> from the above:</p>
<p><span class="math display">\hat{\nu} = \exp(z(1+r)/\sqrt{rn}).</span>
By fixing <span class="math inline">\hat\nu</span> and <span class="math inline">z</span>, we can solve for the corresponding number
of events required: <span class="math display"> n =
(z(1+r)/\log(\hat{\nu}))^2/r.</span></p>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>We continue with the <code>Schoenfeld</code> example event
counts:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Schoenfeld</span><span class="op">$</span><span class="va">n.I</span></span>
<span><span class="co">#&gt; [1] 172 345</span></span></code></pre></div>
<p>We reproduce the approximate hazard ratios required to cross efficacy
bounds using the Schoenfeld approximations above:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gsBoundSummary.html">gsHR</a></span><span class="op">(</span></span>
<span>  z <span class="op">=</span> <span class="va">Schoenfeld</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span>, <span class="co"># Z-values at bound</span></span>
<span>  i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="co"># Analysis number</span></span>
<span>  x <span class="op">=</span> <span class="va">Schoenfeld</span>, <span class="co"># Group sequential design from above</span></span>
<span>  ratio <span class="op">=</span> <span class="va">r</span> <span class="co"># Experimental/control randomization ratio</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6572433 0.8079049</span></span></code></pre></div>
<p>For the following examples, we assume <span class="math inline">r=1</span>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Assuming a Cox model estimate <span class="math inline">\hat\nu</span> and a corresponding event count,
approximately what Z-value (p-value) does this correspond to? We use the
first equation above:</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">.73</span> <span class="co"># Observed hr</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fl">125</span> <span class="co"># Events in analysis</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">events</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">z</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="co"># Z- and p-value</span></span>
<span><span class="co">#&gt; [1] -1.75928655  0.03926443</span></span></code></pre></div>
<p>We replicate the Z-value with</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nSurvival.html">hrn2z</a></span><span class="op">(</span>hr <span class="op">=</span> <span class="va">hr</span>, n <span class="op">=</span> <span class="va">events</span>, ratio <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.759287</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Assuming an efficacy bound Z-value and event count, approximately
what hazard ratio must be observed to cross the bound? We use the second
equation above:</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.025</span><span class="op">)</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fl">120</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">r</span> <span class="op">*</span> <span class="va">events</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6991858</span></span></code></pre></div>
<p>We can reproduce this with <code><a href="../reference/nSurvival.html">zn2hr()</a></code> by switching the sign
of <code>z</code> above; note that the default is <code>ratio = 1</code>
for all of these functions and often is not specified:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nSurvival.html">zn2hr</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="va">z</span>, n <span class="op">=</span> <span class="va">events</span>, ratio <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6991858</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, if we want an observed hazard ratio <span class="math inline">\hat\nu = .8</span> to represent a positive result,
how many events would be need to observe to achieve a 1-sided p-value of
0.025? assuming 2:1 randomization? We use the third equation above:</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">.8</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.025</span><span class="op">)</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">z</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">r</span></span>
<span><span class="va">events</span></span>
<span><span class="co">#&gt; [1] 347.1683</span></span></code></pre></div>
<p>This is replicated with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nSurvival.html">hrz2n</a></span><span class="op">(</span>hr <span class="op">=</span> <span class="va">hr</span>, z <span class="op">=</span> <span class="va">z</span>, ratio <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 347.1683</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="lachin-and-foulkes-design">Lachin and Foulkes design<a class="anchor" aria-label="anchor" href="#lachin-and-foulkes-design"></a>
</h2>
<p>For the purpose of sample size and power for group sequential design,
the <span class="citation">Lachin and Foulkes (1986)</span> is
recommended based on substantial evaluation not documented further here.
We try to make clear here what some of the strengths and weaknesses of
both the <span class="citation">Lachin and Foulkes (1986)</span> method
as well as its implementation in the <code><a href="../reference/nSurv.html">gsDesign::nSurv()</a></code>
(fixed design) and <code><a href="../reference/nSurv.html">gsDesign::gsSurv()</a></code> (group sequential)
functions. For historical and testing purposes, we also discuss use of
the less flexible <code><a href="../reference/nSurvival.html">gsDesign::nSurvival()</a></code> function that was
independently programmed and can be used for some limited validations of
<code><a href="../reference/nSurv.html">gsDesign::nSurv()</a></code>.</p>
<div class="section level3">
<h3 id="model-assumptions">Model assumptions<a class="anchor" aria-label="anchor" href="#model-assumptions"></a>
</h3>
<p>Some detail in specification comes With the flexibility allowed by
the <span class="citation">Lachin and Foulkes (1986)</span> method. The
model assumes</p>
<ul>
<li>Piecewise constant enrollment rates with a target fixed duration of
enrollment; since inter-arrival times follow a Poisson process, the
actual enrollment time to achieve the targeted enrollment is
random.</li>
<li>A fixed minimum follow-up period.</li>
<li>Piecewise exponential failure rates for the control group.</li>
<li>A single, constant hazard ratio for the experimental group relative
to the control group.</li>
<li>Piecewise exponential loss-to-follow-up rates.</li>
<li>A stratified population.</li>
<li>A fixed randomization ratio of experimental to control group
assignment.</li>
</ul>
<p>Other than the proportional hazards assumption, this allows a great
deal of flexibility in trial design assumptions. While <span class="citation">Lachin and Foulkes (1986)</span> adjusts the piecewise
constant enrollment rates proportionately to derive a sample size,
<code><a href="../reference/nSurv.html">gsDesign::nSurv()</a></code> also enables the approach of <span class="citation">Kim and Tsiatis (1990)</span> which fixes enrollment
rates and extends the final enrollment rate duration to power the trial;
the minimum follow-up period is still assumed with this approach. We do
not enable the drop-in option proposed in <span class="citation">Lachin
and Foulkes (1986)</span>.</p>
<p>The two practical differences the <span class="citation">Lachin and
Foulkes (1986)</span> method has from the <span class="citation">Schoenfeld (1981)</span> method are:</p>
<ol style="list-style-type: decimal">
<li>By assuming enrollment, failure and dropout rates the method
delivers sample size <span class="math inline">N</span> as well as
events required.</li>
<li>The variance for the log hazard ratio <span class="math inline">\hat\delta</span> is computed differently and both a
null (<span class="math inline">\sigma^2_0</span>) and alternate
hypothesis (<span class="math inline">\sigma^2_1</span>) variance are
incorporated through the formula <span class="math display">N =
\left(\frac{\Phi^{-1}(1-\alpha)\sigma_0 +
\Phi^{-1}(1-\beta)\sigma_1}{\delta}\right).</span> The null hypothesis
is derived by averaging the alternate hypothesis rates, weighting
according to the proportion randomized in each group.</li>
</ol>
</div>
<div class="section level3">
<h3 id="fixed-design">Fixed design<a class="anchor" aria-label="anchor" href="#fixed-design"></a>
</h3>
<p>We will use the same hazard ratio 0.7 as for the <span class="citation">Schoenfeld (1981)</span> sample size calculations
above. We assume further that the trial will enroll for a constant rate
for 12 months, have a control group median of 8 months (exponential
failure rate <span class="math inline">\lambda = \log(2)/8</span>), a
dropout rate of 0.001 per month, and 16 months of minimum follow-up. As
before, we assume a randomization ratio <span class="math inline">r=1</span>, one-sided Type I error <span class="math inline">\alpha=0.025</span>, 90% power which is equivalent
to Type II error <span class="math inline">\beta=0.1</span>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Experimental/control randomization ratio</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span> <span class="co"># 1-sided Type I error</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Type II error (1 - power)</span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">0.7</span> <span class="co"># Hazard ratio (experimental / control)</span></span>
<span><span class="va">controlMedian</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">dropoutRate</span> <span class="op">&lt;-</span> <span class="fl">0.001</span> <span class="co"># Exponential dropout rate per time unit</span></span>
<span><span class="va">enrollDuration</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">minfup</span> <span class="op">&lt;-</span> <span class="fl">16</span> <span class="co"># Minimum follow-up</span></span>
<span><span class="va">Nlf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nSurv.html">nSurv</a></span><span class="op">(</span></span>
<span>  lambdaC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">controlMedian</span>,</span>
<span>  hr <span class="op">=</span> <span class="va">hr</span>,</span>
<span>  eta <span class="op">=</span> <span class="va">dropoutRate</span>,</span>
<span>  T <span class="op">=</span> <span class="va">enrollDuration</span> <span class="op">+</span> <span class="va">minfup</span>, <span class="co"># Trial duration</span></span>
<span>  minfup <span class="op">=</span> <span class="va">minfup</span>,</span>
<span>  ratio <span class="op">=</span> <span class="va">r</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Sample size: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">Nlf</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>, <span class="st">"Events: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">Nlf</span><span class="op">$</span><span class="va">d</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample size:  422 Events:  330</span></span></code></pre></div>
<p>Recall that the <span class="citation">Schoenfeld (1981)</span>
method recommended 331 events. The two methods tend to yield very
similar event count recommendations, but not the same. Other methods
will also differ slightly; see <span class="citation">Lachin and Foulkes
(1986)</span>. Sample size recommendations can vary more between
methods.</p>
<p>We can get the same result with the <code><a href="../reference/nSurvival.html">nSurvival()</a></code> routine
since only a single enrollment, failure and dropout rate is proposed for
this example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">controlMedian</span></span>
<span><span class="fu"><a href="../reference/nSurvival.html">nSurvival</a></span><span class="op">(</span></span>
<span>  lambda1 <span class="op">=</span> <span class="va">lambda1</span>,</span>
<span>  lambda2 <span class="op">=</span> <span class="va">lambda1</span> <span class="op">*</span> <span class="va">hr</span>,</span>
<span>  Ts <span class="op">=</span> <span class="va">enrollDuration</span> <span class="op">+</span> <span class="va">minfup</span>,</span>
<span>  Tr <span class="op">=</span> <span class="va">enrollDuration</span>,</span>
<span>  eta <span class="op">=</span> <span class="va">dropoutRate</span>,</span>
<span>  ratio <span class="op">=</span> <span class="va">r</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Fixed design, two-arm trial with time-to-event</span></span>
<span><span class="co">#&gt; outcome (Lachin and Foulkes, 1986).</span></span>
<span><span class="co">#&gt; Study duration (fixed):          Ts=28</span></span>
<span><span class="co">#&gt; Accrual duration (fixed):        Tr=12</span></span>
<span><span class="co">#&gt; Uniform accrual:              entry="unif"</span></span>
<span><span class="co">#&gt; Control median:      log(2)/lambda1=8</span></span>
<span><span class="co">#&gt; Experimental median: log(2)/lambda2=11.4</span></span>
<span><span class="co">#&gt; Censoring median:        log(2)/eta=693.1</span></span>
<span><span class="co">#&gt; Control failure rate:       lambda1=0.087</span></span>
<span><span class="co">#&gt; Experimental failure rate:  lambda2=0.061</span></span>
<span><span class="co">#&gt; Censoring rate:                 eta=0.001</span></span>
<span><span class="co">#&gt; Power:                 100*(1-beta)=90%</span></span>
<span><span class="co">#&gt; Type I error (1-sided):   100*alpha=2.5%</span></span>
<span><span class="co">#&gt; Equal randomization:          ratio=1</span></span>
<span><span class="co">#&gt; Sample size based on hazard ratio=0.7 (type="rr")</span></span>
<span><span class="co">#&gt; Sample size (computed):           n=422</span></span>
<span><span class="co">#&gt; Events required (computed): nEvents=330</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="group-sequential-design-1">Group sequential design<a class="anchor" aria-label="anchor" href="#group-sequential-design-1"></a>
</h3>
<p>Now we produce a group sequential design with a default asymmetric
design with a futility bound based on <span class="math inline">\beta</span>-spending. We round interim event counts
and round up the final event count to ensure the targeted power.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Total number of analyses</span></span>
<span><span class="va">lfgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nSurv.html">gsSurv</a></span><span class="op">(</span></span>
<span>  k <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  lambdaC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">controlMedian</span>,</span>
<span>  hr <span class="op">=</span> <span class="va">hr</span>,</span>
<span>  eta <span class="op">=</span> <span class="va">dropoutRate</span>,</span>
<span>  T <span class="op">=</span> <span class="va">enrollDuration</span> <span class="op">+</span> <span class="va">minfup</span>, <span class="co"># Trial duration</span></span>
<span>  minfup <span class="op">=</span> <span class="va">minfup</span>,</span>
<span>  ratio <span class="op">=</span> <span class="va">r</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/toInteger.html">toInteger</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfgs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gsBoundSummary.html">gsBoundSummary</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Analysis</th>
<th align="left">Value</th>
<th align="right">Efficacy</th>
<th align="right">Futility</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">IA 1: 50%</td>
<td align="left">Z</td>
<td align="right">2.7500</td>
<td align="right">0.4150</td>
</tr>
<tr class="even">
<td align="left">N: 440</td>
<td align="left">p (1-sided)</td>
<td align="right">0.0030</td>
<td align="right">0.3391</td>
</tr>
<tr class="odd">
<td align="left">Events: 172</td>
<td align="left">~HR at bound</td>
<td align="right">0.6575</td>
<td align="right">0.9387</td>
</tr>
<tr class="even">
<td align="left">Month: 13</td>
<td align="left">P(Cross) if HR=1</td>
<td align="right">0.0030</td>
<td align="right">0.6609</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">P(Cross) if HR=0.7</td>
<td align="right">0.3422</td>
<td align="right">0.0269</td>
</tr>
<tr class="even">
<td align="left">Final</td>
<td align="left">Z</td>
<td align="right">1.9811</td>
<td align="right">1.9811</td>
</tr>
<tr class="odd">
<td align="left">N: 440</td>
<td align="left">p (1-sided)</td>
<td align="right">0.0238</td>
<td align="right">0.0238</td>
</tr>
<tr class="even">
<td align="left">Events: 344</td>
<td align="left">~HR at bound</td>
<td align="right">0.8076</td>
<td align="right">0.8076</td>
</tr>
<tr class="odd">
<td align="left">Month: 28</td>
<td align="left">P(Cross) if HR=1</td>
<td align="right">0.0239</td>
<td align="right">0.9761</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">P(Cross) if HR=0.7</td>
<td align="right">0.9006</td>
<td align="right">0.0994</td>
</tr>
</tbody>
</table>
<p>Although we did not use the <span class="citation">Schoenfeld
(1981)</span> for sample size, it is still used for the approximate HR
at bound calculation above:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">events</span> <span class="op">&lt;-</span> <span class="va">lfgs</span><span class="op">$</span><span class="va">n.I</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">lfgs</span><span class="op">$</span><span class="va">upper</span><span class="op">$</span><span class="va">bound</span></span>
<span><span class="fu"><a href="../reference/nSurvival.html">zn2hr</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">z</span>, n <span class="op">=</span> <span class="va">events</span><span class="op">)</span> <span class="co"># Schoenfeld approximation to HR</span></span>
<span><span class="co">#&gt; [1] 0.6574636 0.8076464</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h3>
<p>There are various plots available. The approximate hazard ratios
required to cross bounds again use the <span class="citation">Schoenfeld
(1981)</span> approximation. For a <strong>ggplot2</strong> version of
this plot, use the default <code>base = FALSE</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lfgs</span>, pl <span class="op">=</span> <span class="st">"hr"</span>, dgt <span class="op">=</span> <span class="fl">2</span>, base <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SurvivalOverview_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="event-accrual">Event accrual<a class="anchor" aria-label="anchor" href="#event-accrual"></a>
</h3>
<p>The variance calculations for the Lachin and Foulkes method are
mostly determined by expected event accrual under the null and alternate
hypotheses. The null hypothesis characterized above is seemingly
designed so that event accrual will be similar under each hypothesis.
You can see the expected events accrued at each analysis under the
alternate hypothesis with:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Analysis <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>  `Control events` <span class="op">=</span> <span class="va">lfgs</span><span class="op">$</span><span class="va">eDC</span>,</span>
<span>  `Experimental events` <span class="op">=</span> <span class="va">lfgs</span><span class="op">$</span><span class="va">eDE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Analysis</th>
<th align="right">Control events</th>
<th align="right">Experimental events</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">97.04664</td>
<td align="right">74.95336</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">184.48403</td>
<td align="right">159.51599</td>
</tr>
</tbody>
</table>
<p>It is worth noting that if events accrue at the same rate in both the
null and alternate hypothesis, then the expected duration of time to
achieve the targeted events would be shortened. Keep in mind that there
can be many reasons events will accrue at a different rate than in the
design plan.</p>
<p>The expected event accrual of events over time for a design can be
computed as follows:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="va">enrollDuration</span> <span class="op">+</span> <span class="va">minfup</span>, <span class="fl">.025</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">Month</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Month</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/nSurv.html">nEventsIA</a></span><span class="op">(</span>tIA <span class="op">=</span> <span class="va">x</span>, x <span class="op">=</span> <span class="va">lfgs</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Month"</span>, ylab <span class="op">=</span> <span class="st">"Expected events"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Expected event accrual over time"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="SurvivalOverview_files/figure-html/unnamed-chunk-28-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>On the other hand, if you want to know the expected time to accrue
25% of the final events and what the expected enrollment accrual is at
that time, you compute using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nSurv.html">tEventsIA</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lfgs</span>, timing <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">" Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="cn">T</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"\n Expected enrollment:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">eNC</span> <span class="op">+</span> <span class="va">b</span><span class="op">$</span><span class="va">eNE</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"\n Expected control events:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">eDC</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"\n Expected experimental events:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">eDE</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Time:  8.9 </span></span>
<span><span class="co">#&gt;  Expected enrollment: 325.7 </span></span>
<span><span class="co">#&gt;  Expected control events: 49.1 </span></span>
<span><span class="co">#&gt;  Expected experimental events: 36.9</span></span></code></pre></div>
<p>For expected accrual of events without a design returned by
<code><a href="../reference/nSurv.html">gsDesign::gsSurv()</a></code>, see the help file for
<code><a href="../reference/eEvents.html">gsDesign::eEvents()</a></code>.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-JTBook" class="csl-entry">
Jennison, Christopher, and Bruce W. Turnbull. 2000. <em>Group Sequential
Methods with Applications to Clinical Trials</em>. Boca Raton, FL:
Chapman; Hall/CRC.
</div>
<div id="ref-KimTsiatis" class="csl-entry">
Kim, Kyungmann, and Anastasios A. Tsiatis. 1990. <span>“Study Duration
for Clinical Trials with Survival Response and Early Stopping
Rule.”</span> <em>Biometrics</em> 46: 81–92.
</div>
<div id="ref-LachinFoulkes" class="csl-entry">
Lachin, John M., and Mary A. Foulkes. 1986. <span>“Evaluation of Sample
Size and Power for Analyses of Survival with Allowance for Nonuniform
Patient Entry, Losses to Follow-up, Noncompliance, and
Stratification.”</span> <em>Biometrics</em> 42: 507–19.
</div>
<div id="ref-Schoenfeld1981" class="csl-entry">
Schoenfeld, David. 1981. <span>“The Asymptotic Properties of
Nonparametric Tests for Comparing Survival Distributions.”</span>
<em>Biometrika</em> 68 (1): 316–19.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
