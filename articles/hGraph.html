<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiplicity graphs formatting using ggplot2 • gsDesign</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiplicity graphs formatting using ggplot2">
<meta property="og:description" content="gsDesign">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsDesign</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiplicity graphs formatting using ggplot2</h1>
            
      
      
      <div class="hidden name"><code>hGraph.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>With version 3.1, we have added a function to support graphical multiplicity methods using <strong><em>ggplot2</em></strong>. The graphical method is introduced nicely in <span class="citation">Bretz et al. (2011)</span> and supported by the <strong><em>gMCP</em></strong> package (<span class="citation">Rohmeyer and Klinglmueller (2018)</span>). It was extended to group sequential design by <span class="citation">Maurer and Bretz (2013)</span>. While the <strong><em>gMCP</em></strong> package supports graphics, here we add the <code><a href="../reference/hGraph.html">hGraph()</a></code> function to create multiplicity graphs using the <strong><em>ggplot2</em></strong> package as a convenience for those desiring this format. We demonstrate basic formatting in this article and demonstrate use with <strong><em>gMCP</em></strong> elsewhere.</p>
<p>Use of <code><a href="../reference/hGraph.html">hGraph()</a></code> is organized as follows:</p>
<ul>
<li>The basic graph layout</li>
<li>Specifying hypothesis names and <span class="math inline">\(\alpha\)</span>-allocation</li>
<li>Text formatting and location, ellipse size</li>
<li>Specifying the transition matrix between hypotheses</li>
<li>Using colors and legends</li>
</ul>
</div>
<div id="the-basic-graph-layout" class="section level1">
<h1 class="hasAnchor">
<a href="#the-basic-graph-layout" class="anchor"></a>The basic graph layout</h1>
<p>We begin with the default plot to demonstrate the basic formatting below. Hypthoses and initial <span class="math inline">\(\alpha\)</span>-allocation or weighting are presented in shaded ellipses with the first hyothesis specified in the upper-left part of the plot. While the user has full control of ellipse placement and color, the default is to present clockwise on a larger ellipse with gray shading. One advantage of default placement is that generally transition lines between hypotheses will not cross hypothesis ellipses, including when the graph is updated when some hypotheses are rejected. Transition weights between hypotheses are specified on directional lines between the hypothesis ellipses. Try this in a plot window. Note the effect if you change the size of the plot window. In a similar fashion, if you are using R Markdown, <code>fig.width</code> and <code>fig.height</code> parameters will affect formatting.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>()</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-2-1.png" width="720"></p>
</div>
<div id="specifying-hypothesis-names-and-alpha-allocation" class="section level1">
<h1 class="hasAnchor">
<a href="#specifying-hypothesis-names-and-alpha-allocation" class="anchor"></a>Specifying hypothesis names and <span class="math inline">\(\alpha\)</span>-allocation</h1>
<p>Next we specify the number of hypotheses, hypothesis names and <span class="math inline">\(\alpha\)</span>-allocation or weighting. Whereas the default plot above used <span class="math inline">\(\alpha\)</span>-allocation adding to 0.025, here we use weights adding to 1. Note the <code>\n</code> character used to insert a carriage return in hypothesis name text. The character used for weights (specified in <code>wchar</code>) is by default <span class="math inline">\(\alpha\)</span> under Windows and <code>w</code> otherwise. Note the clockwise placement of hypotheses.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">nHypotheses</span> <span class="kw">=</span> <span class="fl">3</span>,
       <span class="kw">nameHypotheses</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"HA\n First"</span>, <span class="st">"HC\n Second"</span>, <span class="st">"HB\n Third"</span>),
       <span class="kw">alphaHypotheses</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.2</span>, <span class="fl">.3</span>, <span class="fl">.5</span>),
       <span class="kw">wchar</span> <span class="kw">=</span> <span class="st">'w'</span> <span class="co"># character before weights</span>
)</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-3-1.png" width="720"></p>
</div>
<div id="text-formatting-and-location-ellipse-size" class="section level1">
<h1 class="hasAnchor">
<a href="#text-formatting-and-location-ellipse-size" class="anchor"></a>Text formatting and location, ellipse size</h1>
<p>You can specify location of hypothesis ellipses in two ways.</p>
<ul>
<li>For the first, specify in radians where on the large ellipse where the first hypothesis is placed. Setting <span class="math inline">\(\pi/2\)</span> for <code>radianStart</code> places the first hypothesis at the center and top of the plot (left plot).</li>
<li>Specifying <code>x</code> and <code>y</code> coordinates, right graph, allows custom placement; note that the differences in minimum and maximum x- and y-values you use as well as window size will impact formatting.</li>
</ul>
<p>Ellipse and the text size as well as maximum significant digits for hypotheses are controlled as follows:</p>
<ul>
<li>Size of text in hypothesis ellipses is controlled by the <code>size</code> parameter (left graph). This text is always placed at the center of the ellipse with no user control.</li>
<li>Size of ellipses is controlled by <code>halfWid</code> (left graph) and <code>halfHgt</code> (not shown; default 0.5) parameters.</li>
<li>
<code>digits</code> specifies the maximum digits for the <span class="math inline">\(\alpha\)</span>-allocation (not shown here; default 5)</li>
</ul>
<p>Box and text size as well as maximum significant digit display for transition weights are controlled as follows:</p>
<ul>
<li>
<code>boxtextsize</code> (right graph) controls text size for transition weights</li>
<li>
<code>trhw</code> (left graph) controls half-width for transition box size</li>
<li>
<code>trhh</code> (not shown; default 0.075) controls half-height for transition box size</li>
<li>
<code>trprop</code> (right graph) specifies the proportional placement of transition weight boxes along the transition lines At present, this is the same for all transitions</li>
<li>
<code>arrowsize</code> (left plot) controls the size of the arrows between ellipses</li>
</ul>
<p>The other parameter shown here is <code>offset</code> (left graph). This is in radians; it increases and decreases offset of transition lines between hypothesis ellipses. If there are not any transition arrows in both directions between any pair of hypotheses, <code>offset = 0</code> is a reasonable option.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu">grid.arrange</span>(
  <span class="co"># left graph in figure</span>
  <span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">nHypotheses</span> <span class="kw">=</span> <span class="fl">3</span>,
         <span class="kw">size</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="co"># decrease hypothesis text size from default 6</span>
         <span class="kw">halfWid</span> <span class="kw">=</span> <span class="fl">1.25</span>, <span class="co"># increase ellipse width from default 0.5</span>
         <span class="kw">trhw</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="co"># increase transition box sizes from default 0.075</span>
         <span class="kw">radianStart</span> <span class="kw">=</span> <span class="no">pi</span>/<span class="fl">2</span>, <span class="co"># first hypothesis top middle</span>
         <span class="kw">offset</span> <span class="kw">=</span> <span class="no">pi</span>/<span class="fl">20</span>, <span class="co"># decrease offset between transition lines</span>
         <span class="kw">arrowsize</span> <span class="kw">=</span> <span class="fl">.03</span> <span class="co"># increase from default 0.02</span>
  ),
  <span class="co"># right graph in figure</span>
  <span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">nHypotheses</span> <span class="kw">=</span> <span class="fl">3</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>, <span class="fl">1</span>, -<span class="fl">1</span>), <span class="co"># custom placement using x and y</span>
       <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, -<span class="fl">1</span>),
       <span class="kw">halfWid</span> <span class="kw">=</span> <span class="fl">0.7</span>, <span class="co"># increase ellipse width from default 0.5</span>
       <span class="kw">boxtextsize</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="co"># decrease box text size from default 4</span>
       <span class="kw">trprop</span> <span class="kw">=</span> <span class="fl">.15</span> <span class="co"># slide transition boxes closer to initiating hypothesis</span>
  ),
  <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>
)</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
</div>
<div id="using-colors-and-legends" class="section level1">
<h1 class="hasAnchor">
<a href="#using-colors-and-legends" class="anchor"></a>Using colors and legends</h1>
<p>The default color palette for ellipse shading is monochrome (left plot below). To limit the parameters used, we have not adjusted text, ellipse and box size as above. Colors are specified as follows:</p>
<ul>
<li>A <code>fill</code> color category; here we group the first 2 hypotheses and last 2 hypotheses (both graphs)</li>
<li>The <code>palette</code> specifies a palette for the colors (right graph)</li>
</ul>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu">grid.arrange</span>(
  <span class="co"># left graph in figure</span>
  <span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>),
         <span class="kw">alphaHypotheses</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.2</span>,<span class="fl">.2</span>,<span class="fl">.2</span>,<span class="fl">.4</span>) * <span class="fl">.025</span>),
  <span class="co"># right graph in figure</span>
  <span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>),
         <span class="kw">palette</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pink"</span>, <span class="st">"lightblue"</span>),
         <span class="kw">alphaHypotheses</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.2</span>,<span class="fl">.2</span>,<span class="fl">.2</span>,<span class="fl">.4</span>) * <span class="fl">.025</span>),
  <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>
)</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-5-1.png" width="720"></p>
<p>Next, we add a legend.</p>
<ul>
<li>The legend is added when the default of <code>legend.positon = "none"</code> is replaced. Here we use a custom position specifying the relative postioning on the (0,1) scale in the x- and y-range of the graph. Commonly used options are <code>"left"</code>, <code>"right"</code>, <code>"top"</code>, or ’“bottom”`</li>
<li>
<code>legend.name</code> (default is none) specifies a name for the legend</li>
<li>
<code>labels</code> specifies labels corresponding to the <code>fill</code> parameter</li>
</ul>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">nHypotheses</span> <span class="kw">=</span> <span class="fl">3</span>,
       <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>),
       <span class="kw">palette</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"yellow"</span>, <span class="st">"lightblue"</span>),
       <span class="kw">legend.name</span> <span class="kw">=</span> <span class="st">"Color scheme"</span>,
       <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Primary"</span>, <span class="st">"Secondary"</span>),
       <span class="kw">legend.position</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.75</span>,<span class="fl">.25</span>)
)</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-6-1.png" width="720"></p>
</div>
<div id="specifying-the-transition-matrix-between-hypotheses" class="section level1">
<h1 class="hasAnchor">
<a href="#specifying-the-transition-matrix-between-hypotheses" class="anchor"></a>Specifying the transition matrix between hypotheses</h1>
<p>Transition weights are specified in matrix format in the variable <code>m</code>. The matrix must be square of dimension <code>nHypotheses</code> and have 0 on the diagonal. Rows respresent the hypotheses from which transitions start; row values should sum to 1. Columns represent the hypotheses to which transition arrows go. Any transition weight of 0 has no corresponding transition line in the figure.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/hGraph.html">hGraph</a></span>(<span class="kw">nHypotheses</span> <span class="kw">=</span> <span class="fl">3</span>,
       <span class="kw">m</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>,
                    <span class="fl">.2</span>, <span class="fl">0</span>, <span class="fl">.8</span>,
                    <span class="fl">.3</span>, <span class="fl">.7</span>, <span class="fl">0</span>),
                  <span class="kw">nrow</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">byrow</span><span class="kw">=</span><span class="fl">TRUE</span>),
)</pre></body></html></div>
<p><img src="hGraph_files/figure-html/unnamed-chunk-7-1.png" width="720"></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Bretz2011">
<p>Bretz, Frank, Martin Posch, Ekkehard Glimm, Florian Klinglmueller, Willi Maurer, and Kornelius Rohmeyer. 2011. “Graphical Approaches for Multiple Comparison Procedures Using Weighted Bonferroni, Simes or Parametric Tests.” <em>Biometrical Journal</em> 53 (6): 894–913. <a href="http://onlinelibrary.wiley.com/doi/10.1002/bimj.201000239/full">http://onlinelibrary.wiley.com/doi/10.1002/bimj.201000239/full</a>.</p>
</div>
<div id="ref-MaurerBretz2013">
<p>Maurer, Willi, and Frank Bretz. 2013. “Multiple Testing in Group Sequential Trials Using Graphical Approaches.” <em>Statistics in Biopharmaceutical Research</em> 5: 311–20. <a href="https://doi.org/10.1080/19466315.2013.807748">https://doi.org/10.1080/19466315.2013.807748</a>.</p>
</div>
<div id="ref-gMCP">
<p>Rohmeyer, Kornelius, and Florian Klinglmueller. 2018. <em>gMCP: Graph Based Multiple Test Procedures</em>. <a href="https://cran.r-project.org/package=gMCP">https://cran.r-project.org/package=gMCP</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
